<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Android | Shiraji's Blog]]></title>
  <link href="http://shiraji.github.io/blog/categories/android/atom.xml" rel="self"/>
  <link href="http://shiraji.github.io/"/>
  <updated>2017-12-05T00:03:36+09:00</updated>
  <id>http://shiraji.github.io/</id>
  <author>
    <name><![CDATA[Shiraji]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PermissionsDispatcher V3ã«é–¢ã—ã¦]]></title>
    <link href="http://shiraji.github.io/blog/2017/12/05/permissions-dispatcher-v3/"/>
    <updated>2017-12-05T00:01:38+09:00</updated>
    <id>http://shiraji.github.io/blog/2017/12/05/permissions-dispatcher-v3</id>
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯ <a href="https://qiita.com/advent-calendar/2017/android">Android Advent Calendar 2017</a> ã®5æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>

<h2>ã¯ã˜ã‚ã«</h2>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher">PermissionsDispatcher</a> v3ãŒä»Šå¹´ã®9æœˆã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸğŸ‰</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="en" dir="ltr">Finally PermissionsDispatcher 3.0.0 is outğŸ˜„ We added fully <a href="https://twitter.com/kotlin?ref_src=twsrc%5Etfw">@kotlin</a> support and a few improvementsğŸ‰EnjoyâœŒï¸ <a href="https://t.co/3a1SQ17AWb">https://t.co/3a1SQ17AWb</a></p>&mdash; hotchemi (@hotchemi) <a href="https://twitter.com/hotchemi/status/908889575208116229?ref_src=twsrc%5Etfw">2017å¹´9æœˆ16æ—¥</a></blockquote>


<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>çµæ§‹å¤§ããªä¿®æ­£ã§ã‚ã£ãŸã®ã§ã€ã“ã‚Œã«é–¢ã—ã¦æ›¸ãã¾ã™ã€‚</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h2>è‡ªå·±ç´¹ä»‹</h2>

<p>PermissionsDispatcherã®ã‚³ãƒŸãƒƒã‚¿ãƒ¼ã®ä¸€äººã§ã™ã€‚ä»Šå¹´ã¯ãã‚Œã»ã©ã‚³ãƒ¼ãƒ‰ã§ã®è²¢çŒ®ãŒå‡ºæ¥ãªã‹ã£ãŸã®ã§ã€ã“ã®è¨˜äº‹ã‚’æ›¸ãã“ã¨ã§ä½•ã‹è²¢çŒ®ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2>æƒ³å®šèª­è€…</h2>

<ul>
<li>PermissionsDispatcherã‚’ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹äºº</li>
<li>PermissionsDispatcher v3ã«èˆˆå‘³ãŒã‚ã‚‹äºº</li>
</ul>


<h2>æ›¸ã„ã¦ã„ãªã„ã“ã¨</h2>

<ul>
<li>PermissionsDispatcherã®ä½¿ã„æ–¹</li>
<li>KotlinPoetã«é–¢ã—ã¦</li>
</ul>


<h2>PermissionsDispatcher v3ã¸ã®ç§»è¡Œæ–¹æ³•</h2>

<p>ã¾ãšv2ã‚’ä½¿ã£ã¦ã„ã‚‹äººã¯v3ã¸ã®ç§»è¡Œã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç§»è¡Œæ‰‹é †ã¯ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/blob/master/doc/migration_guide.md#migrating-to-3x">https://github.com/permissions-dispatcher/PermissionsDispatcher/blob/master/doc/migration_guide.md#migrating-to-3x</a></p>

<p>ç°¡å˜ã«è§£èª¬ã™ã‚‹ã¨ä»¥ä¸‹ã®äºŒç‚¹ã®ä¿®æ­£ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚</p>

<ul>
<li>Kotlinãƒ¦ãƒ¼ã‚¶ã¯<code>XxxPermissionsDispatcher</code>ã‚¯ãƒ©ã‚¹ãŒç„¡ããªã‚Šã€<code>Activity</code>/<code>Fragment</code>ã®æ‹¡å¼µé–¢æ•°ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ</li>
<li>Java/Kotlinå…±ã«<code>XxxWithCheck</code>ãƒ¡ã‚½ãƒƒãƒ‰ãŒ<code>XxxWithPermissionCheck</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«å¤‰æ›´ã«ãªã£ãŸ</li>
</ul>


<h2>ç”Ÿæˆã•ã‚Œã‚‹Kotlinã‚³ãƒ¼ãƒ‰</h2>

<p>å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹Kotlinã®ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/tree/123e50a184e058ad6b4adb0b659a343d79813913/sample-kotlin">sample-kotlinãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</a>ã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p>

<pre><code class="kotlin">private val REQUEST_SHOWCAMERA: Int = 0

private val PERMISSION_SHOWCAMERA: Array&lt;String&gt; = arrayOf("android.permission.CAMERA")

private val REQUEST_SHOWCONTACTS: Int = 1

private val PERMISSION_SHOWCONTACTS: Array&lt;String&gt; = arrayOf("android.permission.READ_CONTACTS", "android.permission.WRITE_CONTACTS")

fun MainActivity.showCameraWithPermissionCheck() {
  if (PermissionUtils.hasSelfPermissions(this, *PERMISSION_SHOWCAMERA)) {
    showCamera()
  } else {
    if (PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCAMERA)) {
      showRationaleForCamera(MainActivityShowCameraPermissionRequest(this))
    } else {
      ActivityCompat.requestPermissions(this, PERMISSION_SHOWCAMERA, REQUEST_SHOWCAMERA)
    }
  }
}

fun MainActivity.showContactsWithPermissionCheck() {
  if (PermissionUtils.hasSelfPermissions(this, *PERMISSION_SHOWCONTACTS)) {
    showContacts()
  } else {
    if (PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCONTACTS)) {
      showRationaleForContacts(MainActivityShowContactsPermissionRequest(this))
    } else {
      ActivityCompat.requestPermissions(this, PERMISSION_SHOWCONTACTS, REQUEST_SHOWCONTACTS)
    }
  }
}

fun MainActivity.onRequestPermissionsResult(requestCode: Int, grantResults: IntArray) {
  when (requestCode) {
    REQUEST_SHOWCAMERA -&gt;
     {
      if (PermissionUtils.verifyPermissions(*grantResults)) {
        showCamera()
      } else {
        if (!PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCAMERA)) {
          onCameraNeverAskAgain()
        } else {
          onCameraDenied()
        }
      }
    }
    REQUEST_SHOWCONTACTS -&gt;
     {
      if (PermissionUtils.verifyPermissions(*grantResults)) {
        showContacts()
      } else {
        if (!PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCONTACTS)) {
          onContactsNeverAskAgain()
        } else {
          onContactsDenied()
        }
      }
    }
  }
}

private class MainActivityShowCameraPermissionRequest(target: MainActivity) : PermissionRequest {
  private val weakTarget: WeakReference&lt;MainActivity&gt; = WeakReference(target)

  override fun proceed() {
    val target = weakTarget.get() ?: return
    ActivityCompat.requestPermissions(target, PERMISSION_SHOWCAMERA, REQUEST_SHOWCAMERA)
  }

  override fun cancel() {
    val target = weakTarget.get() ?: return
    target.onCameraDenied()
  }
}

private class MainActivityShowContactsPermissionRequest(target: MainActivity) : PermissionRequest {
  private val weakTarget: WeakReference&lt;MainActivity&gt; = WeakReference(target)

  override fun proceed() {
    val target = weakTarget.get() ?: return
    ActivityCompat.requestPermissions(target, PERMISSION_SHOWCONTACTS, REQUEST_SHOWCONTACTS)
  }

  override fun cancel() {
    val target = weakTarget.get() ?: return
    target.onContactsDenied()
  }
}
</code></pre>

<p><code>REQUEST_*</code>ã‚„<code>PERMISSION_*</code>ã¯v2ã§ã¯<code>MainActivityPermissionsDispatcher</code>ã‚¯ãƒ©ã‚¹å†…ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€privateã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ã®å®šç¾©ã«å¤‰ã‚ã‚Šã¾ã—ãŸã€‚
ã¾ãŸã€<code>showCameraWithPermissionCheck</code>ã‚„<code>onRequestPermissionsResult</code>ã¯<code>MainActivity</code>ã®æ‹¡å¼µé–¢æ•°ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã®ç‚ºã€<code>MainActivityPermissionsDispatcher</code>ã‚¯ãƒ©ã‚¹ãŒãªããªã‚Šã¾ã—ãŸã€‚(Javaã®æ–¹ã§ã¯å­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚)</p>

<h2>ãªã‚“ã§ã“ã‚“ãªå¤‰æ›´ã«ãªã£ãŸã®ã‹ï¼Ÿ</h2>

<h3>Kotlinã®æ‹¡å¼µé–¢æ•°</h3>

<p><a href="https://github.com/square/kotlinpoet">KotlinPoet</a>ã®å‡ºç¾ã‹ã‚‰ã€ã“ã‚Œã‚’ä½¿ã£ã¦Kotlinã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã—ã¦ã¿ã‚ˆã†->ã©ã†ã›ãªã‚‰Kotlinã£ã½ãæ‹¡å¼µé–¢æ•°ã«ã—ã¦ã¿ã‚ˆã†ï¼ã¨ã„ã†æµã‚Œã§æ‹¡å¼µé–¢æ•°ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚</p>

<p>è©³ç´°ã¯ä»¥ä¸‹ã®Issueã‚’ç¢ºèªã—ã¦ã¿ã¦ä¸‹ã•ã„ã€‚</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/320">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/320</a></p>

<h3>XxxWithPermissionCheckã¸ã®ãƒªãƒãƒ¼ãƒ </h3>

<p>ä»¥ä¸‹ã®Issueã§å•é¡Œæèµ·ã•ã‚Œã¾ã—ãŸã€‚</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/355">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/355</a></p>

<p>ã“ã®Issueã§ã¯æ¼ ç„¶ã¨ã—ãŸè³ªå•ã§ã—ãŸãŒã€Kotlinãƒ¦ãƒ¼ã‚¶ã«å¯¾ã—ã¦ã€æ‹¡å¼µé–¢æ•°ã¨ã—ã¦æä¾›ã™ã‚‹å ´åˆã€<code>WithCheck</code>ã§ã¯æ„å‘³ãŒã‚ã‹ã‚‰ãªã„ã®ã§ã¯ãªã„ã‹ï¼Ÿã¨ã„ã†è©±ã‹ã‚‰ä¸€æ°—ã«v3.0ã«å°å…¥ã™ã‚‹æµã‚Œã«ãªã‚Šã¾ã—ãŸã€‚</p>

<h2>æ‡¸å¿µäº‹é …</h2>

<h3>Kotlinå‘ã‘ã®lint</h3>

<p>PermissionsDispatcherã¯ã‚«ã‚¹ã‚¿ãƒ lintã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€Kotlinå®Ÿè£…å‘ã‘ã®lintã®å¯¾å¿œãŒã¾ã çµ‚ã‚ã£ã¦ã„ã¾ã›ã‚“ã€‚(å®Ÿéš›ã®å•é¡Œã¯UASTã®Kotlinå¯¾å¿œ)</p>

<p>ã“ã®ä»¶ã«é–¢ã™ã‚‹Issueã¯ä»¥ä¸‹</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/373">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/373</a></p>

<h3>Intellij Plugin</h3>

<p><a href="https://github.com/permissions-dispatcher/permissions-dispatcher-plugin">permissions-dispatcher-plugin</a>ã¨è¨€ã†Intellijãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ãŒã€ãƒ¡ã‚¤ãƒ³é–‹ç™ºè€…ã® <a href="https://github.com/shiraji">@shiraji</a> ãŒã‚µãƒœã£ã¦ã„ã‚‹ç‚ºã€v3å¯¾å¿œãŒã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãŸ<a href="https://github.com/permissions-dispatcher/permissions-dispatcher-plugin/issues/79#issuecomment-346983436">ã‚‚ã†v2ã®å¯¾å¿œã—ãªãã¦è‰¯ãã­ï¼Ÿ</a>ã¨è¨€ã£ã¦ãŠã‚Šã€èª°ã‹ã‚‰ã‚‚åè«–ãŒãªã„ç‚ºã€æ€¥ã«v3ã®ã¿ã®ã‚µãƒãƒ¼ãƒˆã«ãªã‚‹äºˆå®šã§ã™ã€‚</p>

<p>ãã‚“ãªã«ã„ãªã„ã¨æ€ã„ã¾ã™ãŒãƒ»ãƒ»ãƒ»ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã¦ã€v2ã®ã¿ã—ã‹ä½¿ã£ã¦ã„ãªã„äººã¯ã“ã‚Œã‚’æ©Ÿã«v3ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚å¤šåˆ†ä»Šå¹´åº¦ä¸­ã«ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ–¹ã‚‚å¯¾å¿œã—ã¾ã™ã€‚</p>

<h2>ã‚ã‚“ã¾ã‚Šåˆ©ç”¨è€…é–¢ä¿‚ãªã„è©±</h2>

<h3>permissions-dispatcher orgãŒå‡ºæ¥ãŸ</h3>

<p><a href="https://github.com/hotchemi">@hotchemi</a>ã•ã‚“ã‹ã‚‰ã®ææ¡ˆã§ã€permissions-dispatcher orgãŒå‡ºæ¥ã¾ã—ãŸã€‚ãŠã‹ã’æ§˜ã§ã€ã¾ã™ã¾ã™ãƒ¡ãƒ³ãƒ†ãƒŠã¨ã—ã¦é ‘å¼µã‚ŠãŸã„ï¼ã¨æ€ãˆã‚‹ã‚ˆã†ã«ã€‚ä»¥ä¸‹ãŒãã®Issue</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/353">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/353</a></p>

<p>æ•°æ—¥å‰ã«ã‚ã£ãŸ<a href="http://hotchemi.hateblo.jp/entry/2017/12/03/003912">PermissionsDispatcherã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ</a>ã«ã‚‚åŒã˜ã‚ˆã†ãªã“ã¨ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚</p>

<h3>æŒ™å‹•ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å¢—ã‚„ã—ãŸ</h3>

<p>7æœˆã«æ›¸ã„ãŸ<a href="http://shiraji.github.io/blog/2017/07/14/testing-against-annotation-processing/">Testing Against Annotation Processing</a>ã«è©³ç´°æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã€èª­ã‚“ã§ãã ã•ã„!!!</p>

<h2>KotlinPoetã«é–¢ã—ã¦</h2>

<p>PermissionsDispatcherã®<a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/tree/123e50a184e058ad6b4adb0b659a343d79813913/processor/src/main/kotlin/permissions/dispatcher/processor/impl/kotlin">ã“ã®è¾ºã‚Š</a>ã‚’çœºã‚ã‚‹ã¨KotlinPoetã®å®Ÿè£…ã®å‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚<a href="https://qiita.com/advent-calendar/2017/kotlin">Kotlin Advent Calendar</a> ã®16æ—¥ç›®ã«KotlinPoetã«é–¢ã™ã‚‹æŠ•ç¨¿ãŒã•ã‚Œã‚‹ã®ã§ã€ãã¡ã‚‰ã‚‚å‚ç…§ã—ã¦ä¸‹ã•ã„ã€‚</p>

<h2>æœ€å¾Œã«</h2>

<p>PermissionsDispatcherã¯éå¸¸ã«è‰¯ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€æ–°ã—ã„ä»•çµ„ã¿ã‚‚ç©æ¥µçš„ã«å–ã‚Šå…¥ã‚Œã¦ã„ã¾ã™ã€‚ä¸€ç·’ã«é–‹ç™ºã—ã¾ã›ã‚“ã‹ï¼Ÿ</p>

<p>ã¾ãŸã€æœ€è¿‘ã€ãƒ“ãƒ«ãƒ‰å‡ºæ¥ãªã„ã€‚ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„ã€‚ãªã©ãªã©READMEèª­ã‚“ã§ã¾ã›ã‚“çš„ãªissueã«ä¸ŠãŒã£ã¦ãã¾ã™ã€‚ã“ã‚Œã®å¯¾å¿œã«æ™‚é–“ã‚’å‰²ã„ã¦ã—ã¾ã„ã€é–‹ç™ºãŒæ»ã‚Šã‚¬ãƒã§ã™ã€‚ã‚‚ã—ã€PermissionsDispatcherã«å¯¾ã—ã¦ä½•ã‹è²¢çŒ®ã—ãŸã„ï¼ã¨è¨€ã†æ–¹ã¯ã€ ã“ã®ã‚ˆã†ãªissueã®å¯¾å¿œã‚„èª¿æŸ»ãªã©ãªã©ãŠæ‰‹ä¼ã„ã—ã¦é ‚ã‘ã‚‹ã¨éå¸¸ã«åŠ©ã‹ã‚Šã¾ã™ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What's Good About Kotlin in Android Development]]></title>
    <link href="http://shiraji.github.io/blog/2016/12/11/whats-good-about-kotlin-in-android-development/"/>
    <updated>2016-12-11T00:00:01+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/12/11/whats-good-about-kotlin-in-android-development</id>
    <content type="html"><![CDATA[<p>ã“ã‚Œã¯<a href="http://qiita.com/advent-calendar/2016/kotlin">Kotlin Advent Calendar 2016</a>ã®12/11ã®è¨˜äº‹ã§ã™ã€‚</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">kotlinã§ã‚„ã‚‹ã¨Androidç°¡å˜ã«æ›¸ã‘ã‚‹æ‰‹æ³•ã¾ã¨ã‚ã¨ã‹ãªã„ã‹ãªã€‚extentionã§bindingadapteræ›¸ãã¨ã‹ã€custom viewã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’JvmOverloadsã§çœç•¥ã¨ã‹ã€‚</p>&mdash; ã—ã‚‰ã˜ (@shiraj_i) <a href="https://twitter.com/shiraj_i/status/768082977569898496">2016å¹´8æœˆ23æ—¥</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>8æœˆ23æ—¥ã«ã“ã‚“ãªã¤ã¶ã‚„ãã‚’ã—ã¦ã€ä»Šæ—¥ã¾ã§æºœã‚ãŸAndroidé–‹ç™ºã‚’ã—ã¦ã„ã¦ã€ã“ã†æ›¸ãã¨ç°¡å˜ã§ã‚­ãƒ¢ãƒã‚¤ã‚¤ï¼ï¼ï¼ã¨ã„ã†Kotlinã®æ–‡æ³•ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<p>(ã‚ãã¾ã§è‡ªåˆ†ãŒæ°—æŒã¡ã„ã„ã£ã¦ã ã‘ã ã‹ã‚‰ã­ï¼)</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h1>è‡ªå·±ç´¹ä»‹</h1>

<p><a href="https://blog.jetbrains.com/kotlin/2016/09/kotlin-1-0-4-is-here/">Kotlin 1.0.4</a>, <a href="https://blog.jetbrains.com/kotlin/2016/11/kotlin-1-0-5-is-here/">Kotlin 1.0.5</a>ã§åå‰ãŒè¼‰ã£ãŸExternal Contributorsã®ä¸€äººã§ã™(å¬‰ã—ã„ã‹ã‚‰è‡ªæ…¢)ã€‚ä¸»ã«Kotlin Pluginã®é™çš„è§£æã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚Kotlinã§æ›¸ã‹ã‚Œã¦ã„ã‚‹<a href="https://github.com/hotchemi/PermissionsDispatcher">PermissionsDispatcher</a>ã®é–‹ç™ºã«ã‚‚å‚åŠ ã—ã¦ã„ã¾ã™ã€‚</p>

<p>Androidé–‹ç™ºçµŒé¨“3å¹´ã»ã©ã§ã€ä»Šã¯Androidã‚’Javaã§ã‚‚Kotlinã§ã‚‚é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚</p>

<p>å°‘ã—ãã‚‰ã„ãªã‚‰ãƒ–ãƒ­ã‚°ã§Android/Kotlinãƒã‚¿æ›¸ã„ã¦ã‚‚ã„ã„ãƒ¬ãƒ™ãƒ«ã‹ãªï¼Ÿã¨æ€ã„ã¾ã™ã€‚</p>

<h1>å‰ææ¡ä»¶ã¨æƒ³å®šèª­è€…</h1>

<ul>
<li>Androidé–‹ç™ºã¯ã‚ã‚‹ç¨‹åº¦çŸ¥ã£ã¦ã„ã‚‹</li>
<li>Kotlinã§ã®Androidèˆˆå‘³ãŒã‚ã‚‹äºº</li>
<li>Kotlinã§ã®Androidé–‹ç™ºè‰¯ã„ã¨è¨€ã‚ã‚Œã¦ã‚‹ã‘ã©ã€ä½•ãŒã„ã„ã‹ã‚ã‹ã‚‰ã­ãªäºº</li>
</ul>


<p>Kotlinã®æ–‡æ³•ã¯Javaã‚³ãƒ¼ãƒ‰ã¨æ¯”è¼ƒã™ã‚Œã°ã ã„ãŸã„ã‚ã‹ã‚‹æ„Ÿã˜ã§è¨˜è¼‰ã—ã¦ã„ãã¾ã™ãŒã€ã‚‚ã—ã‚ã‹ã‚‰ãªã‘ã‚Œã°ã€<a href="https://twitter.com/shiraj_i">@shiraj_i</a>ã«ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã„ãŸã ã‘ã‚Œã°ç­”ãˆã¾ã™ã®ã§ã€ãŠæ°—è»½ã«è³ªå•ã—ã¦ä¸‹ã•ã„ã€‚</p>

<h1>ã‚­ãƒ¢ãƒã‚¤ã‚¤ï¼æ–‡æ³•ãŸã¡</h1>

<p>Kotlinã¯æ›¸ãã‚„ã™ã„ã¨ã‚ˆãè€³ã«ã—ã¾ã™ãŒã€å®Ÿéš›ã©ã†ã„ã†ã¨ã“ã‚ã§ã©ã†ã„ã†æ–‡æ³•ã«ã™ã‚‹ã¨ã€Œæ›¸ãã‚„ã™ã„ã€ã«ãªã‚‹ã®ã‹Javaã¨ã®æ¯”è¼ƒãŒã‚ã¾ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚ãã“ã§ç‹¬æ–­ã¨åè¦‹ã§æ°—æŒã¡ã„ã„æ–‡æ³•ã ã“ã‚Œï¼ã¨æ€ã£ãŸæ–‡æ³•ã‚„æ›¸ãæ–¹ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<p>Kotlinã§ä¸€ç•ªæœ‰åã§ã‚ã‚ã†æ©Ÿèƒ½ã€Nullå®‰å…¨ã‚„ã‚»ãƒŸã‚³ãƒ­ãƒ³ãƒ¬ã‚¹ã«é–¢ã—ã¦ã¯å¤šãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ãƒ–ãƒ­ã‚°ãŒã‚ã‚Šã¾ã™ã®ã§å‰²æ„›ã—ã¾ã™ã€‚</p>

<h2>ä¸€è¡Œãƒ¡ã‚½ãƒƒãƒ‰</h2>

<p>ã‚ã‚‹ç‰¹å®šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿”ã™ã ã‘ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã‚‹æ™‚ã€Javaã§æ›¸ãã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚</p>

<pre><code class="java">public String getName() {
  return "MyApp";
}
</code></pre>

<p>Kotlinã§ã‚‚åŒã˜ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun getName(): String {
  return "MyApp"
}
</code></pre>

<p>ãŸã ã€Kotlinã¯ä¸€è¡Œã§returnå‡ºæ¥ã‚‹å ´åˆã€<code>=</code>ã‚’ã¤ã‘ã¦<code>{}</code>ã‚’çœç•¥ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun getName(): String = "MyApp"
</code></pre>

<p>ã•ã‚‰ã«ã€æˆ»ã‚Šå€¤ã®å‹ãŒæ˜ã‚‰ã‹ãªå ´åˆã€å‹ã®æŒ‡å®šã—ãªãã¦ã‚‚è‰¯ã„ã®ã§</p>

<pre><code class="kotlin">fun getName() = "MyApp"
</code></pre>

<p>çŸ­ãã¦ã ã„ã¶æ°—æŒã¡ã„ã„ã§ã™ã­ã€‚</p>

<p>ã“ã‚“ãªæ„Ÿã˜ã§ã€ä»¥ä¸‹ã‚‚Javaã®ä¾‹æ–‡ã‚’å‡ºã—ã¦ã€Kotlinã§æ°—æŒã¡è‰¯ããªã£ã¦ã„ãã¾ã™ã€‚ãã‚Œã§ã¯ã©ã‚“ã©ã‚“ã„ãã¾ã™ã€‚</p>

<h2>nullæ™‚ä½•ã™ã‚‹ï¼Ÿ</h2>

<p>ä¾‹ãˆã°ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒnullã ã£ãŸå ´åˆã€å³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŠœã‘ã‚‹ã¨ã„ã†å‡¦ç†ã‚’æ›¸ãã¨ã—ã¾ã™ã€‚Javaã®å ´åˆã€çµæ§‹è‰²ã€…æ›¸ã‹ãªãã‚ƒã„ã‘ã¾ã›ã‚“ã€‚</p>

<pre><code class="java">public void foo(@Nullable String text) {
    if (text == null) {
        return;
    }
    // ...
}
</code></pre>

<p>Kotlinã¯nullæ™‚ã«ã“ã‚Œã‚’ã—ã¦ãã‚Œã¨ã„ã†<code>?:</code>æ–‡æ³•ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚Œã‚’ä½¿ã†ã¨ä¸€è¡Œã§æ›¸ã‘ã¡ã‚ƒã„ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun foo(text: String?) {
    text ?: return
    // ...
}
</code></pre>

<p>nullæ™‚ã«åˆ¥å€¤ã‚’ä»£å…¥ã¨ã„ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p>

<pre><code class="kotlin">fun foo(text: String?) {
    val bar = text ?: "" // textã‚’barã«ä»£å…¥ã™ã‚‹ã€‚textãŒnullã ã£ãŸå ´åˆã€ç©ºæ–‡å­—ã¨ã™ã‚‹ã€‚
    // ...
}
</code></pre>

<h2>ç©ºã‚¯ãƒ©ã‚¹</h2>

<p>Javaã§ã¯ç©ºã‚¯ãƒ©ã‚¹ã ã‚ã†ã¨ã€<code>{}</code>ã‚’æ›¸ã‹ãªãã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚ç‰¹ã«ç›®å°ç”¨ã®interfaceã¨ã‹ã§ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒ</p>

<pre><code class="java">interface Foo {}
</code></pre>

<p>Kotlinã§ã¯ãƒœãƒ‡ã‚£ãŒç©ºã®ã‚¯ãƒ©ã‚¹ã®å ´åˆã€<code>{}</code>ã‚’æ›¸ã‹ãªãã¦è‰¯ã„ã®ã§</p>

<pre><code class="kotlin">interface Foo
</code></pre>

<p>ã‚‚ã¡ã‚ã‚“ã€classã§ã‚‚å¯èƒ½ã§ã™ã€‚</p>

<pre><code class="kotlin">class Bar
</code></pre>

<h2>ç©ºãƒ¡ã‚½ãƒƒãƒ‰</h2>

<p>ç©ºãƒ¡ã‚½ãƒƒãƒ‰ã€‚Javaã®å ´åˆã€<code>{}</code>ã‚’æ›¸ã‹ãªãã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚</p>

<pre><code class="java">public void foo() {
}
</code></pre>

<p>Kotlinã®å ´åˆã€ä¸€è¡Œãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒã˜ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun foo() = Unit
</code></pre>

<p>ã‚ã‚Œï¼ŸãªãŒï½‹&hellip;æ°—æŒã¡ã„ã„ã§ã™ã­ï¼</p>

<h2>getter/setterçœç•¥</h2>

<p>Kotlinã§ã¯ã€getter/setterãŒã‚ã£ãŸå ´åˆã€propertyã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚AOSPã«æ›¸ã„ã¦ã‚ã‚‹getter/setterã‚‚åŒæ§˜ã§ã™ã€‚</p>

<p><code>Activity#getLayoutInflater()</code>ã‚’ä½¿ã†ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹å ´åˆ</p>

<pre><code class="java">public LayoutInflater getLayoutInflater() {
    return activity.getLayoutInflater();
}
</code></pre>

<p>Kotlinã§æ›¸ãã¨ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun layoutInflater(): LayoutInflater = activity.layoutInflater
</code></pre>

<p>å®Ÿéš›ã«ã¯Activityå†…ã«<code>layoutInflater</code>ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€KotlinãŒè§£é‡ˆã—ã¦ãã‚Œã¾ã™ã€‚</p>

<p>ã‚‚ã¡ã‚ã‚“ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚‚æ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun layoutInflater(): LayoutInflater = activity.getLayoutInflater()
</code></pre>

<p>ãŸã ã€Android Studioã•ã‚“ãŒã€Œã“ã‚Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ã«å¤‰ãˆãªï¼Ÿã€ã¨ã„ã†ã‚µã‚¸ã‚§ã‚¹ãƒˆãŒå‡ºã¾ã™ã€‚</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/whats-good-about-kotlin-in-android-development/getter_setter.png" alt="getter_setter" /></p>

<p>Javaã£ã½ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨ã“ã®ã‚ˆã†ã«ãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å‡ºã—ã¦ãã‚Œã‚‹ã®ã§ã€éƒ½åº¦ä¿®æ­£ã—ã¦ã„ãã¨Kotlinã‚‰ã—ã„æ–‡æ³•ã®å‹‰å¼·ã‚‚æ—ã‚Šã¾ã™ã€‚(platform typeã«ã¯ã”æ³¨æ„ä¸‹ã•ã„)</p>

<h2>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤</h2>

<p>ã“ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã ã„ãŸã„åŒã˜å€¤ãªã®ã ã‘ã©ã€æ™‚ã€…é•ã†ã‹ã‚‰ã€overloadãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨æ„ã™ã‚‹ã‹ï¼ã£ã¦ã“ã¨ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ</p>

<pre><code class="java">  public static boolean maybeStartActivity(Context context, Intent intent) {
    return maybeStartActivity(context, intent, false);
  }

  private static boolean maybeStartActivity(Context context, Intent intent, boolean chooser) {
      // ...
  }
</code></pre>

<p>ã‹ã®æœ‰åãª<a href="https://github.com/JakeWharton/u2020/blob/70dd9572f45afb21a62ff414d19b7c095d737372/src/main/java/com/jakewharton/u2020/util/Intents.java">u2020</a>ã«ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚</p>

<p>Kotlinã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å®šç¾©å‡ºæ¥ã¾ã™ã€‚</p>

<pre><code class="kotlin">  fun maybeStartActivity(context: Context, intent: Intent, chooser: Boolean = false): Boolean {
      // ...
  }
</code></pre>

<h3>ã‚«ã‚¹ã‚¿ãƒ Viewã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿</h3>

<p>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«é–¢é€£ã—ã¦ã€ã‚«ã‚¹ã‚¿ãƒ Viewã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®šç¾©ã£ã¦å¤§å¤‰ã ã¨æ€ã„ã¾ã™ã€‚</p>

<pre><code class="java">    public CustomView(Context context) {
        this(context, null);
    }

    public CustomView(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public CustomView(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        binding = DataBindingUtil.inflate(LayoutInflater.from(context), R.layout.custom_view, this, true);
    }
</code></pre>

<p>Kotlinã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å®šç¾©ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸Šè¨˜ã®ã‚ˆã†ã«Javaã‹ã‚‰è¦‹ãŸã‚‰è¤‡æ•°ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹<code>@JvmOverloads</code>ã¨ã„ã†ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚</p>

<p>ã“ã‚Œã‚’ä½¿ã†ã¨ã€ã‚«ã‚¹ã‚¿ãƒ Viewã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ä¸€è¡Œå®šç¾©ã™ã‚‹ã ã‘ã§æ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">class @JvmOverloads CustomView(context: Context, attrs: AttributeSet = null, defStyleAttr: Int = 0) {
}
</code></pre>

<p>(Kotlinã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿è‡ªä½“ã¯æ°—æŒã¡ã‚ˆããªã„ã®ã§èª¬æ˜çœç•¥ã—ã¾ã™ã€‚)</p>

<h2>ã‚­ãƒ£ã‚¹ãƒˆã§æ‹¬å¼§å°‘ãªã„</h2>

<p>Javaã§ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹å ´åˆã€æ‹¬å¼§ãŒå¤šããªã‚ŠãŒã¡ã§ã™ã€‚PagerAdapterã®<code>destroyItem</code>ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚</p>

<pre><code class="java">ï¼ Override public void destroyItem(ViewGroup container, int position, Object obj) {
    ((ViewPager) container).removeView((View) obj)
}
</code></pre>

<p>Kotlinã ã¨<code>as</code>ã‚’ä½¿ã£ã¦ã‚­ãƒ£ã‚¹ãƒˆã—ã¾ã™ã€‚æ–‡æ³•çš„ã«ã‚‚æ‹¬å¼§ãŒæ¸›ã‚Šã€ã©ã“ã§æ‹¬å¼§ãŒçµ‚ã‚ã£ã¦ã„ã‚‹ã®ã‹ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚</p>

<pre><code class="kotlin">override fun destroyItem(container: ViewGroup?, position: Int, obj: Any?) {
    (container as ViewPager).removeView(obj as View)
}
</code></pre>

<h3>ã‚­ãƒ£ã‚¹ãƒˆå¤±æ•—æ™‚ã«ä½•ã™ã‚‹ï¼Ÿ</h3>

<p>nullæ™‚ã«ä½•ã™ã‚‹ï¼Ÿã¨ã®çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã‚­ãƒ£ã‚¹ãƒˆå¤±æ•—æ™‚ã«ä½•ã™ã‚‹ã‹ã®å®šç¾©ã‚‚ç°¡å˜ã«ã§ãã¾ã™ã€‚</p>

<pre><code class="kotlin">override fun destroyItem(container: ViewGroup?, position: Int, obj: Any?) {
    container as? ViewPager ?: return
    // ...
}
</code></pre>

<p>ã¾ãŸã€readonlyã®å¤‰æ•°ã®ã‚­ãƒ£ã‚¹ãƒˆã«æˆåŠŸã™ã‚‹ã¨è‡ªå‹•çš„ã«ãã®å¤‰æ•°ã‚’ã‚­ãƒ£ã‚¹ãƒˆã—ã¦ãã‚Œã¾ã™ã€‚ãƒ¡ã‚½ãƒƒãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯readonlyã€‚å„æ‰€ã«å‡ºã¦ãã‚‹<code>val</code>ã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°ã‚‚readonlyã§ã™ã€‚(ä½™è«‡ã§ã™ãŒã€immutableã§ã¯ã‚ã‚Šã¾ã›ã‚“ã®ã§æ³¨æ„ã—ã¦ä¸‹ã•ã„ã€‚)</p>

<pre><code class="kotlin">override fun destroyItem(container: ViewGroup?, position: Int, obj: Any?) {
    container as? ViewPager ?: return
    obj as? View ?: return
    container.removeView(obj)
}
</code></pre>

<p>mutableå¤‰æ•°<code>var</code>ã®å ´åˆã€<code>as?</code>å¾Œã«å¤‰æ›´å¯èƒ½ãªã®ã§ã€è‡ªå‹•çš„ã«ã‚­ãƒ£ã‚¹ãƒˆã—ã¦ã‚‚ã‚‰ãˆãªã„ã®ã§æ³¨æ„ã€‚Kotlinã§ã¯ç†ç”±ãŒãªã„é™ã‚Šã€<code>var</code>ã‚’ä½¿ã‚ãªã„ã»ã†ãŒè‰¯ã„ã§ã™ã€‚</p>

<h2>Utilç³»</h2>

<p>XxxUtilsã¨ã‹ä½œã£ã¦ã€å…¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’staticã«ã—ã¦ã€privateã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½œã£ã¦ãƒ»ãƒ»ãƒ»ã¿ãŸã„ãªã‚„ã‚Šæ–¹ã‚’Javaã§ã¯ã¡ã‚‡ãã¡ã‚‡ãã—ã¦ã„ã¾ã—ãŸã€‚</p>

<pre><code class="java">public class LogUtil {
  private LogUtil() {}

  public void initLog(String tag) {
    Timber.plant(ExtTree(tag))
  }
}
</code></pre>

<p>kotlinã§ã¯Topãƒ¬ãƒ™ãƒ«ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã‘ã°ã€ã“ã®ã‚ˆã†ãªUtilç³»ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun initLog(tag: String) = Timber.plant(ExtTree(tag))
</code></pre>

<p>ä½¿ã„æ–¹ã‚‚Javaã®ã¨ãã¨å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚</p>

<pre><code class="kotlin">import package.initLog

fun foo() {
  initLog("MyApp")
}
</code></pre>

<h2>Stringãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>

<p>Javaã§Stringã®çµåˆã‚’ã™ã‚‹å ´åˆã€ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚</p>

<pre><code class="java">return originalResponse.newBuilder()
                    .header("Cache-Control", "public, max-age=" + 60 * 3)
                    .build();
</code></pre>

<p>Kotlinã«ã¯Stringãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦Stringå†…ã«<code>${}</code>ã§å¤‰æ•°ã‚’æ›¸ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚</p>

<pre><code class="kotlin">return originalResponse.newBuilder()
                    .header("Cache-Control", "public, max-age=${60 * 3}")
                    .build()
</code></pre>

<p>å¤‰æ•°ä¸€ã¤ã ã‘ã§ã‚ã‚‹å ´åˆã€<code>{}</code>ã®çœç•¥ã‚‚å‡ºæ¥ã¾ã™ã€‚</p>

<pre><code class="kotlin">val foo = 1
val bar = "Text$foo" // &lt;= "Text1"ã¨ã„ã†æ–‡å­—åˆ—ã«
</code></pre>

<h2>è¤‡æ•°è¡Œã®String</h2>

<p>Javaã®Stringã§è¤‡æ•°è¡Œã‚’ç”Ÿæˆã™ã‚‹å ´åˆã€çµæ§‹è¾›ã„ã§ã™ã€‚</p>

<pre><code class="java">String text = "aaa\nbbb\nccc";
</code></pre>

<p>Kotlinã§ã¯<code>"""</code>ã‚’ä½¿ã†ã“ã¨ã§è¤‡æ•°è¡Œã®Stringã®å®šç¾©ã‚’å‡ºæ¥ã¾ã™ã€‚</p>

<pre><code class="kotlin">val text = """aaa
              bbb
              ccc""".trimMargin();
</code></pre>

<p>.trimMargin()ã®ã“ã¨ã¨ã‹ã€ãƒãƒ¼ã‚¸ãƒ³ã®é–‹å§‹ä½ç½®ã¨ã‹è¤‡æ•°è¡Œã®Stringã¯çµæ§‹å¤šæ©Ÿèƒ½ã§ã™ãŒã€è©³ç´°çŸ¥ã‚ŠãŸã‘ã‚Œã°<a href="https://kotlinlang.org/docs/reference/basic-types.html#string-literals">å…¬å¼ã®string-literals</a>ã‚’ç¢ºèªã—ã¦ã­ã€‚</p>

<h2>è¤‡æ•°if -> when</h2>

<p>Javaã§ã¯ifãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€ã¡ã‚‡ã£ã¨ã¤ã‚‰ã„ã§ã™ã€‚</p>

<p>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚(Javaã§behaviorã‚’ç‹¬è‡ªå®Ÿè£…ã—ãŸã¨ãã«ä½¿ã£ã¦ã„ãŸã‚³ãƒ¼ãƒ‰)</p>

<pre><code class="java">if (isAnimating) return;
if (consumed &gt; 0) {
    hide(child);
} else {
    show(child);
}
</code></pre>

<p>ã“ã‚Œã‚’Kotlinã§ã‚‚ãã®ã¾ã¾if/elseæ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">if (isAnimating) return
if (consumed &gt; 0) {
    hide(child)
} else {
    show(child)
}
</code></pre>

<p>ã—ã‹ã—ã€ã‚‚ã†å°‘ã—ç°¡å˜ã«whenã§ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p>

<pre><code class="kotlin">when {
    isAnimating -&gt; return
    consumed &gt; 0 -&gt; animateHide(child)
    else -&gt; animateShow(child)
}
</code></pre>

<p>whenã¯Javaã§ã„ã†Switchæ–‡ã«è¿‘ã„ã§ã™ãŒã€ä¸Šè¨˜ã®ã‚ˆã†ã«whenã®å¾Œã«æ¡ä»¶ã‚’ä»˜ã‘ãªã‹ã£ãŸã‚Šã€å¤‰æ•°ã®å‹ã®caseæ–‡ã«å‡ºæ¥ãŸã‚Šã¨ã‚ã¡ã‚ƒãã¡ã‚ƒæ°—æŒã¡ã‚ˆããªã‚Œã¾ã™ã€‚</p>

<h2>å¼</h2>

<p>Kotlinã§ã¯ifã‚„whenãªã©è«¸ã€…ãŒå¼ã§ã™ã€‚</p>

<p>ä¾‹ãˆã°ã€ifã®çµæœã‚’å¤‰æ•°ã«ä»£å…¥ã™ã‚‹å ´åˆã€</p>

<pre><code class="java">int foo;
if(flag) {
    foo = 10;
} else {
    foo = 100;
}
</code></pre>

<p>kotlinã§ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚</p>

<pre><code class="kotlin">val foo = if (flag) {
    10
}  else {
    100
}
</code></pre>

<p>å˜ç´”ãªå ´åˆã€<code>{}</code>ã¯çœç•¥ã™ã‚‹ã®ã§ä¸€è¡Œã§æ›¸ãã“ã¨ãŒå¤šã„ã§ã™ã€‚</p>

<pre><code class="kotlin">val foo = if (flag) 10 else 100
</code></pre>

<p>æ¡ä»¶ã«ã‚ˆã‚Šé•ã£ãŸå€¤ã‚’ä»£å…¥ã—ã¦ã„ã‚‹ã®ã§ã™ãŒ<code>val</code>ã§å®šç¾©å‡ºæ¥ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚</p>

<p>ã¡ãªã¿ã«ã€<a href="https://github.com/hotchemi/PermissionsDispatcher">PermissionsDispatcher</a>ã•ã‚“ã§ã‚‚åˆ©ç”¨ã—ã¦ã„ã¦ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã¨ã—ã¦ä½¿ã£ãŸã‚Šã‚‚ã—ã¦ã„ã¾ã™ã€‚</p>

<pre><code class="kotlin">builder.beginControlFlow("if (\$N\$T.shouldShowRequestPermissionRationale(\$N, \$N))", if (isPositiveCondition) "" else "!", PERMISSION_UTILS, targetParam, permissionField)
</code></pre>

<p>ãƒã‚¹ãƒˆã•ã›ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã®ã§ã™ãŒã€è¤‡é›‘ã«ãªã‚‹ã®ã§è¦‹ã«ãã„å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã«åˆ‡ã‚Šå‡ºã™ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2>Annotation</h2>

<p>Dagger2ã‚’ä½¿ã†å ´åˆã€Activityã‚„Fragmentã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½œã‚‹ãŸã‚ã«ç‹¬è‡ªAnnotationä½œã£ãŸã‚Šã—ã¾ã™ã€‚</p>

<pre><code class="java">@Scope
@Retention(RetentionPolicy.RUNTIME)
public @interface ActivityScope {
}
</code></pre>

<p><code>@interface</code>ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸãŒã€Kotlinã§ã¯<code>annotation</code>ã¨è¡¨ç¾ã—ã¾ã™ã€‚ç›´æ„Ÿçš„ã§è‰¯ã„ã§ã™ã€‚</p>

<pre><code class="kotlin">@Scope
@Retention
annotation class ActivityScope
</code></pre>

<p><code>Retention</code>ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒ<code>RetentionPolicy.RUNTIME</code>ãªã®ã§ã€æŒ‡å®šã‚’çœç•¥å‡ºæ¥ã‚‹ã®ã‚‚ã‚¹ãƒƒã‚­ãƒªã—ã¦ã„ã¦æ°—æŒã¡è‰¯ã„ã§ã™ã€‚</p>

<h2>Singleton</h2>

<p>Javaã§ã¯(ç°¡æ˜“çš„ãª)ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’ä½œæˆã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</p>

<pre><code class="java">public class MoshiUtil {
    private static Moshi moshi;

    public static Moshi getMoshi() {
        if (moshi == null) {
            moshi = Moshi.Builder().add(DateAdapter()).build();
        }
        return moshi;
    }
}
</code></pre>

<p>Kotlinã§ã¯ã€<code>object</code>ã¨ã—ã¦å®šç¾©ã™ã‚Œã°ã‚¢ãƒ—ãƒªå†…ã§ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã™ã€‚</p>

<pre><code class="kotlin">object MoshiUtil {
    val moshi: Moshi by lazy {
        Moshi.Builder().add(DateAdapter()).build()
    }
}
</code></pre>

<p>ä½¿ã„æ–¹ã‚‚Javaã®æ™‚ã¨åŒã˜ã§ã™ã€‚</p>

<pre><code class="kotlin">MoshiUtil.moshi.adapter(BlackjackHand::java.class)
</code></pre>

<h2>rx.Observableã®ThreadæŒ‡å®šæ–¹æ³•</h2>

<p>ã¡ã‚‡ã“ã£ã¨ã—ãŸã“ã¨ãªã®ã§ã™ãŒã€Rxã®å®Ÿè¡Œã‚¹ãƒ¬ãƒƒãƒ‰æ–¹æ³•ã®æŒ‡å®šã‚‚æ°—æŒã¡ã‚ˆãæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<pre><code class="java">load()
  .subscribeOn(AndroidSchedulers.mainThread())
  .observeOn(AndroidSchedulers.mainThread())
  .subscribe();
</code></pre>

<p>Kotlinã®æ‹¡å¼µãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ©ç”¨ã—ã€ã‚¹ãƒ¬ãƒƒãƒ‰ã®æŒ‡å®šæ–¹æ³•ã‚’å®šç¾©ã—ã¾ã™ã€‚</p>

<pre><code class="kotlin">val &lt;T&gt; Observable&lt;T&gt;.observeOnUI: Observable&lt;T&gt;
    get() = observeOn(AndroidSchedulers.mainThread())

val &lt;T&gt; Observable&lt;T&gt;.observeOnIO: Observable&lt;T&gt;
    get() = observeOn(Schedulers.io())

val &lt;T&gt; Observable&lt;T&gt;.observeOnComputation: Observable&lt;T&gt;
    get() = observeOn(Schedulers.computation())

val &lt;T&gt; Observable&lt;T&gt;.subscribeOnUI: Observable&lt;T&gt;
    get() = subscribeOn(AndroidSchedulers.mainThread())

val &lt;T&gt; Observable&lt;T&gt;.subscribeOnIO: Observable&lt;T&gt;
    get() = subscribeOn(Schedulers.io())

val &lt;T&gt; Observable&lt;T&gt;.subscribeOnComputation: Observable&lt;T&gt;
    get() = subscribeOn(Schedulers.computation()).unsubscribeOn(Schedulers.computation())
</code></pre>

<p>ã“ã®æ‹¡å¼µãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ©ç”¨ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">load()
  .subscribeOnIO
  .observeOnIO
  .subscribe()
</code></pre>

<h2>Databindingã®BindingAdapteræŒ‡å®šæ–¹æ³•</h2>

<p>Databindingã®BindingAdapterã®<a href="https://developer.android.com/reference/android/databinding/BindingAdapter.html">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰</a>ã‚’Kotlinã§æ›¸ã„ã¦ã¿ã¾ã™ã€‚</p>

<pre><code class="java">@BindingAdapter("android:bufferType")
public static void setBufferType(TextView view, TextView.BufferType bufferType) {
    view.setText(view.getText(), bufferType);
}
</code></pre>

<p>ã“ã‚ŒãŒã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚<code>view</code>ãŒæ¶ˆãˆã¾ã—ãŸã€‚</p>

<pre><code class="java">@BindingAdapter("android:bufferType")
fun TextView.setBufferType(TextView.BufferType bufferType) {
    setText(getText(), bufferType)
}
</code></pre>

<h2>Databindingã®onClickãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆæŒ‡å®šæ–¹æ³•</h2>

<p>ã“ã‚Œã‚‚æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã§ã„ãã¾ã™ã€‚</p>

<pre><code class="xml">&lt;android.support.design.widget.FloatingActionButton
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="@dimen/spacing"
                android:onClick="@{viewModel::onClickTopFab}"
                app:backgroundTint="@color/action_green"
                app:fabSize="normal"
                app:layout_anchor="@id/app_bar"
                app:layout_anchorGravity="bottom|end"
                app:srcCompat="@drawable/plus"/&gt;
</code></pre>

<pre><code class="java">fun onClickFab(View view) {
    Toast.makeText(view.getContext(), R.string.message_fab, Toast.LENGTH_LONG).show();
}
</code></pre>

<p>kotlinã§ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚Toastè¡¨ç¤ºç”¨ã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚‚å®šç¾©ã—ã¦ã„ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun View.onClickFab() {
    Toast.makeText(context, R.string.message_fab, Toast.LENGTH_LONG).show()
}
</code></pre>

<p>ã¡ã‚‡ã£ã¨æ‰‹ãŒæ»‘ã‚‹ã¨</p>

<pre><code class="kotlin">fun Context.showLongToast(@StringRes id: Int) {
    Toast.makeText(this, id, Toast.LENGTH_LONG).show()
}

fun View.onClickFab() {
    context.showLongToast(R.string.message_fab)
}
</code></pre>

<p>topãƒ¬ãƒ™ãƒ«ã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã¯ç”¨æ³•ãƒ»ç”¨é‡ã‚’å®ˆã£ã¦æ­£ã—ããŠä½¿ã„ä¸‹ã•ã„ã€‚</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h2>createIntent/newInstance</h2>

<p>è‡ªåˆ†ã¯createIntent/newInstanceãƒ‘ã‚¿ãƒ¼ãƒ³å¤§å¥½ãã§ã™ã€‚</p>

<p>ã“ã‚Œã‚‚æ°—æŒã¡ã‚ˆããªã‚Œã¾ã™ã€‚</p>

<pre><code class="java">public static Intent createIntent(Context context) {
    Intent intent = new Intent(context, MyActivity.class);
    return intent;
}
</code></pre>

<p>applyã‚’ä½¿ã£ã¦ã€ä¸€è¡Œã«ã€‚</p>

<pre><code class="kotlin">companion object {
    fun createIntent(context: Context) = Intent(context, MyActivity::class.java).apply { }
}
</code></pre>

<p>newInstanceã‚‚ã‚„ã£ã¦ã¿ã¾ã™ã€‚</p>

<pre><code class="java">public static SimpleDialogFragment newInstance(MyPacel entity) {
    SimpleDialogFragment fragment = new SimpleDialogFragment();
    Bundle bundle = new Bundle();
    bundle.putParcelable(PARCELABLE_KEY, entity);
    fragment.setArguments(bundle);
    return fragment;
}
</code></pre>

<p>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚ŠãŸã„ã ã‘ãªã®ã§ã™ãŒã€çµæ§‹å†—é•·çš„ã§è¾›ã„ã€‚ã€‚ã€‚</p>

<p>Kotlinã§çŸ­ãã—ã¦ã¿ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun newInstance(entity: MyPacel) =
ã€€   SimpleDialogFragment().apply {
         arguments = Bundle().apply {
             putParcelable(PARCELABLE_KEY, entity)
         }
     }
</code></pre>

<p>nestãŒæ¿€ã—ã„ã®ã§ãƒãƒ©ã—ã¦ã„ãã¾ã™ã€‚ã¾ãšã¯ã“ã®éƒ¨åˆ†ã€‚</p>

<pre><code class="kotlin">arguments = Bundle().apply {
    putParcelable(PARCELABLE_KEY, entity)
}
</code></pre>

<p>ã“ã‚Œã‚’ãƒ¡ã‚½ãƒƒãƒ‰åŒ–ã™ã‚‹ã¨</p>

<pre><code class="kotlin">private fun entity(bundle: Bundle, entity: MyPacel): Bundle {
    return bundle.apply {
        putParcelable(PARCELABLE_KEY, entity)
    }
}
</code></pre>

<p>bundleå¤‰æ•°ã«é–¢ã™ã‚‹å‡¦ç†ãªã®ã§ã€Bundleã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã¨è€ƒãˆã‚‹ã¨è‰¯ã•æ°—ã€‚</p>

<pre><code class="kotlin">private fun Bundle.entity(entity: MyPacel): Bundle {
    return this.apply {
        putParcelable(PARCELABLE_KEY, entity)
    }
}
</code></pre>

<p>returnæ–‡ä¸€æ–‡ãªã®ã§ã€çœç•¥ã€‚thisã‚‚å¿…è¦ãªã„ã®ã§ã€çœç•¥ã€‚</p>

<pre><code class="kotlin">private fun Bundel.entity(entity: MyPacel) = apply { putParcelable(PARCELABLE_KEY, entity) }
</code></pre>

<p>ã‚¤ãƒã‚³ã‚³</p>

<pre><code class="kotlin">fun newInstance(entity: MyPacel) =
     SimpleDialogFragment().apply {
         arguments = Bundle().entity(entity)
     }

private fun Bundel.entity(entity: MyPacel) = apply { putParcelable(PARCELABLE_KEY, entity) }
</code></pre>

<p>SimpleDialogFragmentã®éƒ¨åˆ†ã‚‚åŒã˜ã‚ˆã†ã«æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦æ›¸ãã¨ã€‚</p>

<pre><code class="kotlin">fun newInstance(entity: MyPacel) = MyFragment().entity(entity)

private fun MyFragment.entity(entity: MyPacel) = apply { arguments = Bundle().entity(entity) }

private fun Bundle.entity(entity: MyPacel) = apply { putParcelable(KEY, entity) }
</code></pre>

<p>ã ã„ã¶ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ¨ã‚¤ãƒ¨ãƒ¨ã‚¤ãƒ¨ã€‚</p>

<h2>setVisibleOrGone</h2>

<p>Databindingå‰ã«ã¯çµæ§‹ä½¿ã†ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§ã™ãŒã€ä»Šã¨ãªã£ã¦ã¯ãƒ»ãƒ»ãƒ»ã§ã‚‚ä¸€å¿œã€‚</p>

<p>Viewã‚’æ¶ˆã—ã¦ã—ã¾ã†ã‹è¡¨ç¤ºã™ã‚‹ã‹ã‚’Booleanå€¤ã§åˆ¤åˆ¥ã™ã‚‹ã‚ˆã†ãªUtilç³»ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ãã¨ã™ã‚‹ã¨</p>

<pre><code class="java">public static void setVisibleOrGone(View view, boolean isVisible) {
    if(view == null) {
        return;
    }

    if(isVisible) {
        view.setVisiblity(View.VISIBLE);
    } else {
        view.setVisiblity(View.GONE);
    }
}
</code></pre>

<p>ã“ã‚Œã‚’kotlinã§æ›¸ãã¨ä¸€è¡Œã§ã„ã‘ã¾ã™ã€‚</p>

<pre><code class="kotlin">fun View?.setVisibleOrGone(isVisible: Boolean) {
    this?.visibility = if (isVisible) View.VISIBLE else View.GONE
}
</code></pre>

<p>nullableã®Viewã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã€nullå®‰å…¨ã€setter/getterã®çœç•¥ã€ifå¼åˆ©ç”¨ã¨è‰²ã€…Javaã«ã¯ãªã„æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>

<h2>BaseObservable</h2>

<p>å…¬å¼ã«ã‚ã‚‹ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’Kotlinã§æ°—æŒã¡ã‚ˆãæ›¸ã„ã¦ã¿ã¾ã™ã€‚</p>

<pre><code class="java">private static class User extends BaseObservable {
   private String firstName;
   private String lastName;
   @Bindable
   public String getFirstName() {
       return this.firstName;
   }
   @Bindable
   public String getLastName() {
       return this.lastName;
   }
   public void setFirstName(String firstName) {
       this.firstName = firstName;
       notifyPropertyChanged(BR.firstName);
   }
   public void setLastName(String lastName) {
       this.lastName = lastName;
       notifyPropertyChanged(BR.lastName);
   }
}
</code></pre>

<p>Kotlinã§æ›¸ãå‰ã«ã€ãã‚‚ãã‚‚å…·ä½“çš„ã«ã‚„ã‚‹ã“ã¨ã¯ä»¥ä¸‹</p>

<ul>
<li>getterã«<code>@Bindable</code>ã‚’ã¤ã‘ã‚‹</li>
<li>setterã®æœ€å¾Œã«<code>notifyPropertyChanged(BR.firstName);</code>ã‚’å‘¼ã¶</li>
</ul>


<pre><code class="kotlin">class User : BaseObservable {
    @get:Bindable
    var firstName: String
        set(value) {
            field = value
            notifyPropertyChanged(BR.firstName)
        }

    @get:Bindable
    var lastName: String
        set(value) {
            field = value
            notifyPropertyChanged(BR.lastName)
        }
}
</code></pre>

<p>setter/getterã‚’æ›¸ã‹ãªãã¦è‰¯ã„ã®ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã£ã¦ã¾ã™ã€‚</p>

<p>ã‚‚ã†ã¡ã‚‡ã„ã‚­ãƒ¬ã‚¤ã«ãªã‚Œã°ã„ã„ã§ã™ãŒã€ã‚ã–ã‚ã–ãƒ¡ã‚½ãƒƒãƒ‰æ›¸ã‹ãªãã¦è‰¯ã„ã¨ã„ã†ã ã‘ã§ã‚‚æ°—æŒã¡ã„ã„ã§ã™ã€‚</p>

<h2>Delegate</h2>

<p>ç¶™æ‰¿ã™ã‚‹ãªï¼ç§»è­²ã—ã‚ï¼ã¨è¨€ã‚ã‚Œã¦ã‚‚Javaä½¿ã£ã¦ã‚‹ã¨ç¶™æ‰¿ã—ã¡ã‚ƒã„ã‚¬ãƒãªã®ã§ã™ãŒã€Kotlinã®DelegateãŒã‚ã‚‹ã¨ã“ã‚Œã‚’ç©æ¥µçš„ã«åˆ©ç”¨ã—ãŸã„ãªã¨æ€ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<p>ViewModelã«Rxã®Subscriptionã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€<code>Activity#onDestroy</code>æ™‚ã«<code>unsubscribe()</code>ã—ãŸã„ã¨ã„ã†æ™‚</p>

<pre><code class="java">public class MyViewModel(CompositeSubscription compositeSubscription) {
    // ...
    public void unsubscribe() {
        compositeSubscription.unsubscribe();
    }
}
</code></pre>

<p>Kotlinã§delegateã™ã‚‹ã¨<code>unsubscribe()</code>ã¯æ›¸ã‹ãªãã¦è‰¯ããªã‚Šã¾ã™ã€‚</p>

<pre><code class="kotlin">class MyViewModel @Inject constructor(var compositeSubscription: CompositeSubscription) : Subscription by compositeSubscription {
    // ...
}
</code></pre>

<p>Activityã§ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚<code>MyViewModel</code>ã§å®Ÿè£…ã—ã¦ã„ãªã„ã®ã«<code>unsubscribe()</code>ã‚’å‘¼ã¶ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚</p>

<pre><code class="kotlin">class ThirdActivity : AppCompatActivity() {

    @field:[Inject]
    lateinit var viewModel: MyViewModel

// ...

    override fun onDestroy() {
        super.onDestroy()
        viewModel.unsubscribe()
    }
</code></pre>

<p>droidkaigi2016ã®<a href="https://github.com/konifar/droidkaigi2016/blob/master/app/src/main/java/io/github/droidkaigi/confsched/widget/ArrayRecyclerAdapter.java">ArrayRecyclerAdapter</a>ã‚’ä»¥ä¸‹ã®ã‚ˆã†ãªã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‘ã©ã€ä½™è¨ˆãªãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ç”Ÿãˆã‚‹ã®ã§ã€ç”¨æ³•ã¨ç”¨é‡ã‚’(çœç•¥</p>

<pre><code class="kotlin">abstract class MutableListRecyclerAdapter&lt;T, VH : RecyclerView.ViewHolder&gt;(private val list: MutableList&lt;T&gt;) :
        RecyclerView.Adapter&lt;VH&gt;(), Iterable&lt;T&gt;, MutableList&lt;T&gt; by list {

    var itemClickListener: View.OnClickListener? = null

    override fun getItemCount() = list.size

    @UiThread fun addAllWithNotification(items: Collection&lt;T&gt;) {
        val position = itemCount
        addAll(items)
        notifyItemChanged(position)
    }

    @UiThread fun reset(items: Collection&lt;T&gt;) {
        clear()
        addAll(items)
        notifyDataSetChanged()
    }
}
</code></pre>

<h2>é…å»¶åˆæœŸåŒ–</h2>

<p>Javaã§ç°¡å˜ã«ã‚„ã‚‹å ´åˆã€getterã‚’ä½œæˆã—ã€propertyã‚¢ã‚¯ã‚»ã‚¹ã¯ç¦æ­¢ã—ã€ãã®getterçµŒç”±ã§å€¤ã‚’å–å¾—ã™ã‚‹ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã®ä¸‹ã‹ã‚ã†ã˜ã¦å‡ºæ¥ã‚‹é…å»¶åˆæœŸåŒ–å‡¦ç†ã§ã™ã€‚</p>

<p>ä¾‹ãˆã°ã€Databindingã®<code>setContentView</code>ã‚’åˆ©ç”¨ã—ã¦ã€<code>binding</code>å¤‰æ•°ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚</p>

<pre><code class="java">private MyBinding binding;

private MyBinding getBinding() {
    if(binding == null) {
        binding = DataBindingUtil.setContentView&lt;MyBinding&gt;(this, R.layout.my);
    }
    return binding;
}
</code></pre>

<p>Kotlinã§ã¯<code>by lazy</code>ã‚’åˆ©ç”¨ã—ã¦æ›¸ãã¾ã™ã€‚ä¸€æ—¦<code>binding</code>å¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰<code>by lazy</code>å†…ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã€åˆæœŸåŒ–ã•ã‚Œã¾ã™ã€‚</p>

<pre><code class="kotlin">private val binding by lazy {
    DataBindingUtil.setContentView&lt;MyBinding&gt;(this, R.layout.my)
}
</code></pre>

<p>valã§ã‚ã‚‹ã®ã‚‚è‰¯ã„ã§ã™ã€‚</p>

<p>ã¡ãªã¿ã«ã€enumã«<code>ordinal</code>ã§ã¯ãªã„æ•°å€¤ã®idã‚’æŒ¯ã‚‹ã“ã¨ãŒã‚ã£ã¦ã€ãã®idã‹ã‚‰é€†å¼•ãã—ãŸã„æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸ<code>SparseArray</code>ã‚’åˆ©ç”¨ã—ã¦é€†å¼•ãã—ã¾ã™ãŒã€ã“ã®æ™‚ã‚‚<code>by lazy</code>ä½¿ã„ã¾ã™ã€‚</p>

<pre><code class="kotlin">companion object {
    private val lookup: SparseArray&lt;MyType&gt; by lazy {
        SparseArray&lt;MyType&gt;().apply {
            EnumSet.allOf(MyType::class.java).forEach {
                this@apply.put(it.typeId, it)
            }
        }
    }

    fun fromTypeId(typeId: Int): MyType {
        return lookup.get(typeId)
    }
}
</code></pre>

<h2>parameter name</h2>

<p>Javaã§ã¯ãã‚‚ãã‚‚å‡ºæ¥ãªã„ã®ã§ã™ãŒã€ã“ã‚“ãªPOJOã‚¯ãƒ©ã‚¹ãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚</p>

<pre><code class="java">public class User {
    private String firstName;
    private String lastName;

    public User(firstName, lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }

    // ãã®ä»–ãƒ¡ã‚½ãƒƒãƒ‰çœç•¥
}
</code></pre>

<pre><code class="java">new User("å", "å§“");
new User("å§“", "å"); // é–“é•ã£ã¦ã„ã‚‹ã‘ã©ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«OK
</code></pre>

<p>ç¬¬ä¸€å¼•æ•°ã¨ç¬¬äºŒå¼•æ•°ãŒfirstãªã®ã‹ã€lastãªã®ã‹ã‚ã‹ã‚‰ãªããªã‚Šã¾ã™ã€‚ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã—ã‹æ¤œçŸ¥ã§ããªã„ã®ãŒè¾›ã„ã§ã™ã€‚</p>

<pre><code class="kotlin">User(firstName = "å", lastName = "å§“")
</code></pre>

<p>å¼•æ•°ã«åå‰ã‚’è¨­å®šã—ã¦ã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚ã“ã‚“ãªã“ã¨ã—ã¦ã‚‚å±ã‚‰ã‚Œã¾ã›ã‚“ã—ã€é–“é•ã£ãŸæŒ™å‹•ã‚’èµ·ã“ã—ã¾ã›ã‚“ã€‚åŒã˜ã‚ˆã†ãªå‹ãŒå¤šã„ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã§ã¯ç©æ¥µçš„ã«ä½¿ã†ã¨æ°—æŒã¡è‰¯ã„ã§ã™ã€‚</p>

<pre><code class="kotlin">User(lastName = "å§“", firstName = "å")
</code></pre>

<h2>æœ€å¾Œã«</h2>

<p>ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã¿ãŸã‚‰çµæ§‹å‡ºã¦ãã¾ã—ãŸã€‚ã€‚ã€‚</p>

<p>è½é¸ã—ãŸé …ç›®ã¯<a href="https://gist.github.com/shiraji/2caf8190d282ab3594a21b467980267e">gist</a>ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Difference Between Generating Java and Generating Kotlin for Developing IntelliJ Plugin]]></title>
    <link href="http://shiraji.github.io/blog/2016/05/14/difference-between-psijavafile-and-ktfile/"/>
    <updated>2016-05-14T23:33:07+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/05/14/difference-between-psijavafile-and-ktfile</id>
    <content type="html"><![CDATA[<h1>Motivation</h1>

<p>I am a maintainer of <a href="https://github.com/shiraji/permissions-dispatcher-plugin">PermissionsDispatcher Plugin</a> which generates Java and Kotlin for <a href="https://github.com/hotchemi/PermissionsDispatcher">PermissionsDispatcher</a>
Since Kotlin is getting famous for Android developers, I thought IntelliJ plugins, which generate Android code, should support both Java and Kotlin. (By the way, <a href="http://blog.jetbrains.com/kotlin/2016/05/kotlin-1-0-2-is-here/">Kotlin 1.0.2</a> now supports Android lint! This definitely will lead more developers use Kotlin!)</p>

<p>However, while I was developing this plugin, I found really hard to generate both Java and Kotlin code.</p>

<p>So, this blog post describes what are the differences between generating Java and generating Kotlin using IntelliJ plugin.</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h1>Environment</h1>

<p>Before start taking about the differences, the followings are the environment for this blog post.</p>

<ul>
<li>Kotlin for writing the plugin</li>
<li>Gradle for build</li>
<li><a href="https://github.com/JetBrains/gradle-intellij-plugin">gradle-intellij-plugin</a></li>
</ul>


<h1><code>getClasses</code> for <code>PsiJavaFile</code> vs <code>KtFile</code></h1>

<pre><code class="kotlin">e.getData(CommonDataKeys.PSI_FILE)
</code></pre>

<p>returns <code>PsiJavaFile</code> or <code>KtFile</code>. Both of them implements <code>PsiClassOwner</code> which means both of them has the method <code>PsiClass[] getClasses()</code>.</p>

<p>This method is useful for <code>PsiJavaFile</code>, it lets access classes of the file. The plugin can read/write contents of the classes.</p>

<p>For <code>KtFile</code>, I expected the same. I want to read/write code of classes. Yes, you can read <code>.class</code> file. It is not classes inside <code>.kt</code> file. So, even though, it has methods <code>add</code>, <code>addBefore</code> or <code>addAfter</code>, <code>KtFile#classes#add</code> throw an exception says the plugin won&rsquo;t be able to write contents to <code>.class</code> file!</p>

<p>If you want to get objects for generating code of Kotlin, then use <code>KtFile#getDeclarations</code>.</p>

<h1><code>PsiFactory</code></h1>

<p>This could be because I could not find the best way to generate code&hellip;but PsiFactory of Java and Kotlin is different</p>

<pre><code class="Kotlin">val psiElementFactory: PsiElementFactory = JavaPsiFacade.getElementFactory(project)
</code></pre>

<pre><code class="Kotlin">val psiFactory: KtPsiFactory = KtPsiFactory(project)
</code></pre>

<h1>Generating annotations</h1>

<p><code>PsiMethod</code> has modifierList</p>

<pre><code class="kotlin">method.modifierList.addAnnotation("Foo")`
</code></pre>

<p>On the other hand, <code>KtNamedFunction</code> has <code>addAnnotationEntry</code></p>

<pre><code class="kotlin">function.addAnnotationEntry(psiFactory.createAnnotationEntry("@Foo"))
</code></pre>

<p>To insert new line after annotation, you need to add new line manually.</p>

<pre><code class="kotlin">val entry = function.addAnnotationEntry(psiFactory.createAnnotationEntry("@Foo"))
entry.add(psiFactory.createNewLine())
</code></pre>

<h1>Generating methods</h1>

<p><code>PsiClass</code> is easy to add method. Use <code>createMethodFromText</code> and <code>add</code> to <code>PsiClass</code></p>

<pre><code class="kotlin">val methodTemplate = """void foo() {
}""".trimMargin()
val method = JavaPsiFacade.getElementFactory(project).createMethodFromText(methodTemplate, psiClass)
psiClass.add(method)
</code></pre>

<p>For kotlin, it&rsquo;s almost the same.</p>

<pre><code class="kotlin">val psiFactory = KtPsiFactory(project)
val function = psiFactory.createFunction("""void foo() {
}""".trimMargin())
ktClass.getBody()!!.addBefore(function, ktClass.getBody()!!.rBrace)
</code></pre>
]]></content>
  </entry>
  
</feed>
