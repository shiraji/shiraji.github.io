<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Kotlin | Shiraji's Blog]]></title>
  <link href="http://shiraji.github.io/blog/categories/kotlin/atom.xml" rel="self"/>
  <link href="http://shiraji.github.io/"/>
  <updated>2018-03-17T20:30:48+09:00</updated>
  <id>http://shiraji.github.io/</id>
  <author>
    <name><![CDATA[Shiraji]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[How to Kontribute (V3) - Setup]]></title>
    <link href="http://shiraji.github.io/blog/2018/03/04/how-to-kontribute-v3-setup/"/>
    <updated>2018-03-04T00:00:01+09:00</updated>
    <id>http://shiraji.github.io/blog/2018/03/04/how-to-kontribute-v3-setup</id>
    <content type="html"><![CDATA[<p>This blog post describes how to start Kontribute or how to start contributing <a href="https://kotlinlang.org/">Kotlin</a>.</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h2>Who am I?</h2>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/how-to-kontribute-v3.002.jpg" alt="intro" /></p>

<p>I&rsquo;ve been kontributors since July 2016. I made more than 60 commits by now. I love Kotlin, my beautiful wife and lovely son.</p>

<p>I talked about this topic a few times in different places. After speaking at DroidKaigi 2018 and Kotlin Night Kolkata, some people gave me feed back that it is also helpful for new Kontributors if I make a blog post in English. I am too lazy to write this from scratch, so I re-used some of contents from those presentation.</p>

<h2>Prerequisite</h2>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/how-to-kontribute-v3.004.jpg" alt="Prerequisite" /></p>

<p>This blog entry does not explain how to use git/github and how to write Kotlin.</p>

<p>Since I mainly contribute to Kotlin plguin features, this blog post focus on how to contribute kotlin plugin. However, once you undersntand how to do it, it is really easy to contribute to Kotlin Languages, Kotlin JS or Kotlin Native because it is in the same repository.</p>

<h2>Outline</h2>

<ul>
<li>Setup</li>
<li>Communication</li>
<li>1st Recommended Ways to Kontribute</li>
<li>Developing/Testing Kotlin plugin</li>
</ul>


<h2>Setup</h2>

<p>It &ldquo;was&rdquo; the hardest part but not anymore. This is the reason I updated this topic as v3. There are &ldquo;only&rdquo; 4 parts of setups</p>

<h3>JDK</h3>

<p>The first one is JDK.</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/how-to-kontribute-v3.007.jpg" alt="JDK" /></p>

<p>You need to install 3 differenct versions of JDKs.</p>

<p>In order to use those JDK, you must setup environment variables like this</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/how-to-kontribute-v3.008.jpg" alt="JDK-env-var" /></p>

<p>It&rsquo;s quite annoying to set each environment variables. Here is what I did.</p>

<pre><code>export JAVA_HOME=`/usr/libexec/java_home -v "1.8"`
export JDK_16=`/usr/libexec/java_home -v "1.6"`
export JDK_17=`/usr/libexec/java_home -v "1.7"`
export JDK_18=`/usr/libexec/java_home -v "1.8"`
</code></pre>

<h3>Intellij IDEA &amp; Plugins</h3>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/how-to-kontribute-v3.008.jpg" alt="JDK-env-var" /></p>

<p>As for Intellij IDEA, you can use both community and ultimate version.</p>

<p>To make sure you are using latest kotlin plugin, check the following gif.</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/plugin_up-to-date.gif" alt="plugin_up-to-date" /></p>

<h3>Open project</h3>

<p>After setup Intellij IDEA, you can open kotlin plugin. First time you open the project, Intellij downloads all dependencies using gradle. It took me about 50 mins. Just wait.</p>

<h3>Module</h3>

<p>After downloading dependencies, you will notice that there is no source code in Project view. To fix this problem, you will need to do the followings:</p>

<ul>
<li>Go to File | New | Module from Existing Sources | and then select
<code>build.gradle.kts</code> file</li>
<li>After selecting the file, <code>Import Module from Gradle</code> dialog popup. Select <code>use default gradle wrapper</code></li>
</ul>


<p>The following gif visually describes the steps</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/module.gif" alt="module" /></p>

<h3>Run</h3>

<p>Setup is done. Let&rsquo;s run it. To run it, select <code>IDEA</code> run configuration and hit run button.</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-kontribute-v3/run.gif" alt="run" /></p>

<p>After waiting a few minites, the child IDEA shows up. What does this do is if you change your Kotlin project, the change is bundle to this child IDEA. You can test your new feature in this child IDEA.</p>

<p>If you cannot build or run the project, ask other kontributors! In next blog post, I will talk about how to intract with other Kontributors or JetBrains team.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KotlinPoetã‚’ä½¿ã£ã¦ã¿ãŸ]]></title>
    <link href="http://shiraji.github.io/blog/2017/12/16/kotlinpoet/"/>
    <updated>2017-12-16T00:00:01+09:00</updated>
    <id>http://shiraji.github.io/blog/2017/12/16/kotlinpoet</id>
    <content type="html"><![CDATA[<p>KotlinPoetã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ã—ãŸã®ã§ã€è§¦ã‚Šã ã‘ã§ã™ãŒã€ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<p>ãªãŠã“ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¯KotlinPoet v0.6.0ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>

<h1>æƒ³å®šèª­è€…</h1>

<ul>
<li>KotlinPoetã«èˆˆå‘³ãŒã‚ã‚‹äºº</li>
<li>JavaPoetã‚’è§¦ã£ãŸã“ã¨ãƒ»å‹‰å¼·ã—ãŸã“ã¨ãŒã‚ã‚‹äºº</li>
</ul>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h1>æ›¸ã„ã¦ã„ãªã„ã“ã¨</h1>

<ul>
<li>JavaPoetã®èª¬æ˜</li>
</ul>


<h1>KotlinPoetã«ã¤ã„ã¦</h1>

<p>KotlinPoetã¯Kotlinã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚’æ‰‹åŠ©ã‘ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚<a href="https://github.com/square/javapoet">JavaPoet</a>ã®Kotlinç‰ˆã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚</p>

<p>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒ</p>

<pre><code class="kotlin">val greeterClass = ClassName("", "Greeter")
val file = FileSpec.builder("", "HelloWorld")
    .addType(TypeSpec.classBuilder("Greeter")
        .primaryConstructor(FunSpec.constructorBuilder()
            .addParameter("name", String::class)
            .build())
        .addProperty(PropertySpec.builder("name", String::class)
            .initializer("name")
            .build())
        .addFunction(FunSpec.builder("greet")
            .addStatement("println(%S)", "Hello, \$name")
            .build())
        .build())
    .addFunction(FunSpec.builder("main")
        .addParameter("args", String::class, VARARG)
        .addStatement("%T(args[0]).greet()", greeterClass)
        .build())
    .build()

file.writeTo(System.out)
</code></pre>

<p>ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚</p>

<pre><code class="kotlin">class Greeter(val name: String) {
  fun greet() {
    println("Hello, $name")
  }
}

fun main(vararg args: String) {
  Greeter(args[0]).greet()
}
</code></pre>

<p>KotlinPoetã®ç´¹ä»‹ã¯<a href="https://youtu.be/_obNBSldffw">KotlinConfã®å‹•ç”»</a>ã‚’è¦³ã‚‹ã¨è‰¯ã„ã§ã™ã€‚</p>

<h1>KotlinPoetã®è€ƒãˆæ–¹</h1>

<p>å®Ÿã¯ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ä¸€ç‚¹ã€éå¸¸ã«<strong>é¢ç™½ã„</strong>ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚</p>

<pre><code class="kotlin">class Greeter(val name: String)
</code></pre>

<p>primary constructorã®ç”Ÿæˆã§ã™ã€‚KotlinPoetã®ä»¥ä¸‹ã®éƒ¨åˆ†ã§ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚</p>

<pre><code class="kotlin">val file = FileSpec.builder("", "HelloWorld")
    .addType(TypeSpec.classBuilder("Greeter")
        .primaryConstructor(FunSpec.constructorBuilder()
            .addParameter("name", String::class)
            .build())
        .addProperty(PropertySpec.builder("name", String::class)
            .initializer("name")
            .build())
</code></pre>

<p>valã®<code>name</code>ã‚’primary constructorã«å…¥ã‚Œã‚‹ã ã‘ãªã®ã§ã™ãŒã€KotlinPoetã§ã¯3å›ã‚‚<code>name</code>ã¨è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚</p>

<p>ã›ã£ã‹ããªã®ã§ã€ä¸€ã¤ãšã¤è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã¾ãšPropertyã‚’ç”Ÿæˆã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚</p>

<pre><code class="kotlin">val file = FileSpec.builder("", "HelloWorld")
    .addType(TypeSpec.classBuilder("Greeter")
        .addProperty(PropertySpec.builder("name", String::class)
            .build())
</code></pre>

<p>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p>

<pre><code class="kotlin">class Greeter {
    val name: String
}
</code></pre>

<p>æ¬¡ã«primary constructorã«<code>name</code>å…¥ã‚ŒãŸã„ç‚ºã€primary constructorã®è¨­å®šã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p>

<pre><code class="diff">val file = FileSpec.builder("", "HelloWorld")
    .addType(TypeSpec.classBuilder("Greeter")
        .primaryConstructor(FunSpec.constructorBuilder()
            .addParameter("name", String::class)
            .build())
+       .addProperty(PropertySpec.builder("name", String::class)
+           .build())
</code></pre>

<p>ãã†ã™ã‚‹ã¨ã“ã‚“ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p>

<pre><code class="kotlin">class Greeter(name: String) {
    val name: String
}
</code></pre>

<p>æœ€å¾Œã«primary constructorã¨propertyã‚’é€£çµã™ã‚‹ãŸã‚ã€åˆæœŸåŒ–æ–¹æ³•ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p>

<pre><code class="diff">val file = FileSpec.builder("", "HelloWorld")
    .addType(TypeSpec.classBuilder("Greeter")
        .primaryConstructor(FunSpec.constructorBuilder()
            .addParameter("name", String::class)
            .build())
        .addProperty(PropertySpec.builder("name", String::class)
+           .initializer("name")
            .build())
</code></pre>

<p>ã“ã‚Œã§ã‚ˆã†ã‚„ãä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<pre><code class="kotlin">class Greeter(val name: String)
</code></pre>

<p>ã“ã‚Œã¯ã€è¨˜è¿°ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯å…¨ã¦ç”Ÿæˆã™ã‚‹ã€‚æœ€é©åŒ–ã¯KotlinPoetãŒã™ã‚‹ã€‚ã¨ã„ã†KotlinPoetã®è€ƒãˆã‹ã‚‰ãã¦ã„ã‚‹ãã†ã§ã™ã€‚</p>

<p>KotlinConfã®å‹•ç”»ã§ã‚‚è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã®ã§ç¢ºèªã—ã¦è¦‹ã¦ãã ã•ã„ã€‚ <a href="https://youtu.be/_obNBSldffw?t=20m40s">https://youtu.be/_obNBSldffw?t=20m40s</a></p>

<p>è‹¥å¹²æ–‡æ³•ãŒé•ã£ãŸã‚Šã€ä¸Šè¨˜ã®ã‚ˆã†ãªéš ã‚ŒãŸç™–ãŒã‚ã‚‹ç‚ºã€JavaPoetã«æ…£ã‚Œã¦ã„ã‚‹æ–¹ã¯æœ€åˆæˆ¸æƒ‘ã†ã“ã¨ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã®ã§ã€ç”Ÿæˆå¾Œã®ã‚³ãƒ¼ãƒ‰ã‚’ã—ã£ã‹ã‚Šç¢ºèªã—ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚</p>

<p>ã¡ãªã¿ã«PermissionsDispatcherã¯KotlinPoetã®ã“ã®æŒ™å‹•ã‚’çŸ¥ã‚‰ãšã€<a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/commit/ddf14a1dd005d5fbb9bb51b445815d6af7e7125f">èª¤ã£ã¦å¤–ã«å‡ºã¦ã—ã¾ã£ãŸpropertyã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«è©°ã‚ã‚‹ç‚ºã®ä¿®æ­£</a>ã‚’v3.0.1ã§å…¥ã‚Œã¦ã„ã¾ã™:joy:</p>

<p>ãã®æ™‚ã®é–‹ç™ºè€…ã®ã¤ã¶ã‚„ãã§ã™ã€‚</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">parameterã¨propertyä½œæˆã—ã¦ã€propertyå´ã®initializerã«å¤‰æ•°åã‚’å…¥ã‚Œã‚‹ã¨ã„ã†ã¾ã˜ã‹ã‚ˆï¼ã£ã¦æ–¹æ³•ã§é”æˆã—ãŸã€‚ãªãœã§ãã‚‹ã®ã‹ï¼Ÿã¨ã„ã†ç–‘å•ã¯å¾Œã§èª¿æŸ»ã—ã‚ˆã†ã€‚</p>&mdash; shiraji (@shiraj_i) <a href="https://twitter.com/shiraj_i/status/909327774044663808?ref_src=twsrc%5Etfw">2017å¹´9æœˆ17æ—¥</a></blockquote>


<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<h1>ãã®ä»–ã®ä»£è¡¨çš„ãªã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆæ–¹æ³•</h1>

<p>ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¯ãƒ©ã‚¹ã€ã‚¯ãƒ©ã‚¹ãƒ¡ãƒ³ãƒãƒ¼ã€ãƒ—ãƒ©ã‚¤ãƒãƒªã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®é–¢æ•°ã«é–¢ã—ã¦ã¯ä¸Šè¨˜ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã¿ã¦ãã ã•ã„ã€‚</p>

<p>ãã‚Œä»¥å¤–ã®ã‚ˆãä½¿ã„ãã†ãªã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆæ–¹æ³•ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚</p>

<h2>ã‚³ãƒ¡ãƒ³ãƒˆ</h2>

<p>kotlinpoetã®ã‚³ãƒ¼ãƒ‰</p>

<pre><code class="kotlin">val file = FileSpec.builder("com.github.shiraji", "HelloWorld").addComment("ã‚³ãƒ¡ãƒ³ãƒˆ").build()
</code></pre>

<p>ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰</p>

<pre><code class="kotlin">// ã‚³ãƒ¡ãƒ³ãƒˆ
package com.github.shiraji
</code></pre>

<p><code>FileSpec.Builder</code>ã®<code>addComment</code>ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ç‚ºã€ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šéƒ¨ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ã„ã¾ã™ãŒã€Builderã®ç¨®é¡(TypeSpec.Builderãªã©)ã«ã‚ˆã‚Šã‚³ãƒ¡ãƒ³ãƒˆä½ç½®ãŒèª¿æ•´ã•ã‚Œã¾ã™ã€‚</p>

<h2>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h2>

<pre><code class="kotlin">val message = "ãµãµãµ"
val file = FileSpec.builder("com.github.shiraji", "HelloWorld").addComment("ã‚³ãƒ¡ãƒ³ãƒˆ %L", message).build()
</code></pre>

<pre><code class="kotlin">// ã‚³ãƒ¡ãƒ³ãƒˆ ãµãµãµ
package com.github.shiraji
</code></pre>

<p>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯JavaPoetã¨é•ã„<code>%</code>ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ãã®ä»–ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯<a href="https://square.github.io/kotlinpoet/0.x/kotlinpoet/com.squareup.kotlinpoet/-code-block/index.html">ã“ã¡ã‚‰</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>

<p><em>ã“ã‚Œä»¥é™ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚ã¾ã‚Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€æœ¬æ¥ã¯ã“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ä½¿ã†æ–¹ãŒè‰¯ã„ã§ã™ã€‚</em></p>

<h2>initãƒ¡ã‚½ãƒƒãƒ‰</h2>

<pre><code class="kotlin">    val file = FileSpec.builder("com.github.shiraji", "HelloWorld")
            .addType(TypeSpec.classBuilder("Greeter")
                    .addInitializerBlock(CodeBlock.builder()
                            .addStatement("val i = 10")
                            .build())
                    .build())
            .build()
</code></pre>

<pre><code class="kotlin">package com.github.shiraji

class Greeter {
  init {
    val i = 10
  }
}
</code></pre>

<h2>Secondary Constructor</h2>

<pre><code class="kotlin">    val file = FileSpec.builder("com.github.shiraji", "HelloWorld")
            .addType(TypeSpec.classBuilder("Greeter")
                    .primaryConstructor(FunSpec.constructorBuilder()
                            .addParameter("name", String::class)
                            .build())
                    .addFunction(FunSpec.constructorBuilder()
                            .callThisConstructor("name") // callSuperConstructorã‚‚ã‚ã‚Šã¾ã™ã€‚
                            .addParameter("name", String::class)
                            .addParameter("lastname", String::class)
                            .build())
                    .build())
            .build()
</code></pre>

<pre><code class="kotlin">package com.github.shiraji

import kotlin.String

class Greeter(name: String) {
  constructor(name: String, lastname: String) : this(name)
}
</code></pre>

<h2>æ‹¡å¼µé–¢æ•°</h2>

<pre><code class="kotlin">    val file = FileSpec.builder("com.github.shiraji", "HelloWorld")
            .addType(TypeSpec.classBuilder("Greeter")
                    .addFunction(FunSpec.builder("foo")
                            .receiver(String::class)
                            .build())
                    .build())
            .build()
</code></pre>

<pre><code class="kotlin">package com.github.shiraji

import kotlin.String

class Greeter {
  fun String.foo() {
  }
}
</code></pre>

<h2>Classä¿®é£¾å­(Dataã‚¯ãƒ©ã‚¹)</h2>

<pre><code class="kotlin">    val file = FileSpec.builder("com.github.shiraji", "HelloWorld")
            .addType(TypeSpec.classBuilder("Foo")
                    .addModifiers(KModifier.DATA) // KModifier.ENUMãªã©ã‚‚ã‚ã‚Šã¾ã™
                    .build())
</code></pre>

<pre><code class="kotlin">package com.github.shiraji

data class Foo
</code></pre>

<h2>if/else</h2>

<pre><code class="kotlin">    val file = FileSpec.builder("com.github.shiraji", "HelloWorld")
            .addType(TypeSpec.classBuilder("Greeter")
                    .addFunction(FunSpec.builder("foo")
                            .beginControlFlow("if (true)")
                            .addStatement("val i1 = 10")
                            .endControlFlow()
                            .beginControlFlow("else")
                            .addStatement("val i2 = 20")
                            .endControlFlow()
                            .build())
                    .build())
            .build()
</code></pre>

<pre><code class="kotlin">package com.github.shiraji

class Greeter {
  fun foo() {
    if (true) {
      val i1 = 10
    }
    else {
      val i2 = 20
    }
  }
}
</code></pre>

<h2>when</h2>

<pre><code class="kotlin">    val file = FileSpec.builder("com.github.shiraji", "HelloWorld")
            .addType(TypeSpec.classBuilder("Greeter")
                    .addFunction(FunSpec.builder("foo")
                            .addStatement("val i = 10")
                            .beginControlFlow("when(i)")
                            .beginControlFlow("10 -&gt;")
                            .addStatement("println(\"foo\")")
                            .endControlFlow()
                            .beginControlFlow("20 -&gt;")
                            .addStatement("println(\"foo222\")")
                            .endControlFlow()
                            .endControlFlow()
                            .build())
                    .build())
            .build()
</code></pre>

<pre><code class="kotlin">package com.github.shiraji

class Greeter {
  fun foo() {
    val i = 10
    when(i) {
      10 -&gt; {
        println("foo")
      }
      20 -&gt; {
        println("foo222")
      }
    }
  }
}
</code></pre>

<h2>ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</h2>

<pre><code class="kotlin">val file = FileSpec.builder("com.github.shiraji", "HelloWorld").addComment("%&gt;ã‚³ãƒ¡ãƒ³ãƒˆ").build()
</code></pre>

<pre><code class="kotlin">  // ã‚³ãƒ¡ãƒ³ãƒˆ
  package com.github.shiraji
</code></pre>

<p>ã‚¢ãƒ³ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã•ã‚Œã‚‹ã¾ã§ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã•ã‚Œç¶šã‘ã¾ã™ã€‚</p>

<h2>ã‚¢ãƒ³ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</h2>

<pre><code class="kotlin">val file = FileSpec.builder("com.github.shiraji", "HelloWorld").addComment("%&gt;ã‚³ãƒ¡ãƒ³ãƒˆ%&lt;").build()
</code></pre>

<pre><code class="kotlin">  // ã‚³ãƒ¡ãƒ³ãƒˆ
package com.github.shiraji
</code></pre>

<h1>APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h1>

<p>ãã®ä»–çŸ¥ã‚ŠãŸã‘ã‚Œã°ã€KotlinPoetã®<a href="https://square.github.io/kotlinpoet/0.x/kotlinpoet/com.squareup.kotlinpoet/index.html">APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚(v0.xç³»ä»¥é™ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯URLãŒå¤‰æ›´ã•ã‚Œã‚‹ã‹ã‚‚ï¼Ÿ)</p>

<h1>æœ€å¾Œã«</h1>

<p>PermissionsDispatcherã®<a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/tree/123e50a184e058ad6b4adb0b659a343d79813913/processor/src/main/kotlin/permissions/dispatcher/processor/impl/kotlin">ã“ã®è¾ºã‚Š</a>ã‚’çœºã‚ã‚‹ã¨KotlinPoetã®å®Ÿè£…ã®å‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PermissionsDispatcher V3ã«é–¢ã—ã¦]]></title>
    <link href="http://shiraji.github.io/blog/2017/12/05/permissions-dispatcher-v3/"/>
    <updated>2017-12-05T00:01:38+09:00</updated>
    <id>http://shiraji.github.io/blog/2017/12/05/permissions-dispatcher-v3</id>
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯ <a href="https://qiita.com/advent-calendar/2017/android">Android Advent Calendar 2017</a> ã®5æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>

<h2>ã¯ã˜ã‚ã«</h2>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher">PermissionsDispatcher</a> v3ãŒä»Šå¹´ã®9æœˆã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸğŸ‰</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="en" dir="ltr">Finally PermissionsDispatcher 3.0.0 is outğŸ˜„ We added fully <a href="https://twitter.com/kotlin?ref_src=twsrc%5Etfw">@kotlin</a> support and a few improvementsğŸ‰EnjoyâœŒï¸ <a href="https://t.co/3a1SQ17AWb">https://t.co/3a1SQ17AWb</a></p>&mdash; hotchemi (@hotchemi) <a href="https://twitter.com/hotchemi/status/908889575208116229?ref_src=twsrc%5Etfw">2017å¹´9æœˆ16æ—¥</a></blockquote>


<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>çµæ§‹å¤§ããªä¿®æ­£ã§ã‚ã£ãŸã®ã§ã€ã“ã‚Œã«é–¢ã—ã¦æ›¸ãã¾ã™ã€‚</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h2>è‡ªå·±ç´¹ä»‹</h2>

<p>PermissionsDispatcherã®ã‚³ãƒŸãƒƒã‚¿ãƒ¼ã®ä¸€äººã§ã™ã€‚ä»Šå¹´ã¯ãã‚Œã»ã©ã‚³ãƒ¼ãƒ‰ã§ã®è²¢çŒ®ãŒå‡ºæ¥ãªã‹ã£ãŸã®ã§ã€ã“ã®è¨˜äº‹ã‚’æ›¸ãã“ã¨ã§ä½•ã‹è²¢çŒ®ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2>æƒ³å®šèª­è€…</h2>

<ul>
<li>PermissionsDispatcherã‚’ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹äºº</li>
<li>PermissionsDispatcher v3ã«èˆˆå‘³ãŒã‚ã‚‹äºº</li>
</ul>


<h2>æ›¸ã„ã¦ã„ãªã„ã“ã¨</h2>

<ul>
<li>PermissionsDispatcherã®ä½¿ã„æ–¹</li>
<li>KotlinPoetã«é–¢ã—ã¦</li>
</ul>


<h2>PermissionsDispatcher v3ã¸ã®ç§»è¡Œæ–¹æ³•</h2>

<p>ã¾ãšv2ã‚’ä½¿ã£ã¦ã„ã‚‹äººã¯v3ã¸ã®ç§»è¡Œã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç§»è¡Œæ‰‹é †ã¯ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/blob/master/doc/migration_guide.md#migrating-to-3x">https://github.com/permissions-dispatcher/PermissionsDispatcher/blob/master/doc/migration_guide.md#migrating-to-3x</a></p>

<p>ç°¡å˜ã«è§£èª¬ã™ã‚‹ã¨ä»¥ä¸‹ã®äºŒç‚¹ã®ä¿®æ­£ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚</p>

<ul>
<li>Kotlinãƒ¦ãƒ¼ã‚¶ã¯<code>XxxPermissionsDispatcher</code>ã‚¯ãƒ©ã‚¹ãŒç„¡ããªã‚Šã€<code>Activity</code>/<code>Fragment</code>ã®æ‹¡å¼µé–¢æ•°ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ</li>
<li>Java/Kotlinå…±ã«<code>XxxWithCheck</code>ãƒ¡ã‚½ãƒƒãƒ‰ãŒ<code>XxxWithPermissionCheck</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«å¤‰æ›´ã«ãªã£ãŸ</li>
</ul>


<h2>ç”Ÿæˆã•ã‚Œã‚‹Kotlinã‚³ãƒ¼ãƒ‰</h2>

<p>å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹Kotlinã®ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/tree/123e50a184e058ad6b4adb0b659a343d79813913/sample-kotlin">sample-kotlinãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</a>ã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p>

<pre><code class="kotlin">private val REQUEST_SHOWCAMERA: Int = 0

private val PERMISSION_SHOWCAMERA: Array&lt;String&gt; = arrayOf("android.permission.CAMERA")

private val REQUEST_SHOWCONTACTS: Int = 1

private val PERMISSION_SHOWCONTACTS: Array&lt;String&gt; = arrayOf("android.permission.READ_CONTACTS", "android.permission.WRITE_CONTACTS")

fun MainActivity.showCameraWithPermissionCheck() {
  if (PermissionUtils.hasSelfPermissions(this, *PERMISSION_SHOWCAMERA)) {
    showCamera()
  } else {
    if (PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCAMERA)) {
      showRationaleForCamera(MainActivityShowCameraPermissionRequest(this))
    } else {
      ActivityCompat.requestPermissions(this, PERMISSION_SHOWCAMERA, REQUEST_SHOWCAMERA)
    }
  }
}

fun MainActivity.showContactsWithPermissionCheck() {
  if (PermissionUtils.hasSelfPermissions(this, *PERMISSION_SHOWCONTACTS)) {
    showContacts()
  } else {
    if (PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCONTACTS)) {
      showRationaleForContacts(MainActivityShowContactsPermissionRequest(this))
    } else {
      ActivityCompat.requestPermissions(this, PERMISSION_SHOWCONTACTS, REQUEST_SHOWCONTACTS)
    }
  }
}

fun MainActivity.onRequestPermissionsResult(requestCode: Int, grantResults: IntArray) {
  when (requestCode) {
    REQUEST_SHOWCAMERA -&gt;
     {
      if (PermissionUtils.verifyPermissions(*grantResults)) {
        showCamera()
      } else {
        if (!PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCAMERA)) {
          onCameraNeverAskAgain()
        } else {
          onCameraDenied()
        }
      }
    }
    REQUEST_SHOWCONTACTS -&gt;
     {
      if (PermissionUtils.verifyPermissions(*grantResults)) {
        showContacts()
      } else {
        if (!PermissionUtils.shouldShowRequestPermissionRationale(this, *PERMISSION_SHOWCONTACTS)) {
          onContactsNeverAskAgain()
        } else {
          onContactsDenied()
        }
      }
    }
  }
}

private class MainActivityShowCameraPermissionRequest(target: MainActivity) : PermissionRequest {
  private val weakTarget: WeakReference&lt;MainActivity&gt; = WeakReference(target)

  override fun proceed() {
    val target = weakTarget.get() ?: return
    ActivityCompat.requestPermissions(target, PERMISSION_SHOWCAMERA, REQUEST_SHOWCAMERA)
  }

  override fun cancel() {
    val target = weakTarget.get() ?: return
    target.onCameraDenied()
  }
}

private class MainActivityShowContactsPermissionRequest(target: MainActivity) : PermissionRequest {
  private val weakTarget: WeakReference&lt;MainActivity&gt; = WeakReference(target)

  override fun proceed() {
    val target = weakTarget.get() ?: return
    ActivityCompat.requestPermissions(target, PERMISSION_SHOWCONTACTS, REQUEST_SHOWCONTACTS)
  }

  override fun cancel() {
    val target = weakTarget.get() ?: return
    target.onContactsDenied()
  }
}
</code></pre>

<p><code>REQUEST_*</code>ã‚„<code>PERMISSION_*</code>ã¯v2ã§ã¯<code>MainActivityPermissionsDispatcher</code>ã‚¯ãƒ©ã‚¹å†…ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€privateã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ã®å®šç¾©ã«å¤‰ã‚ã‚Šã¾ã—ãŸã€‚
ã¾ãŸã€<code>showCameraWithPermissionCheck</code>ã‚„<code>onRequestPermissionsResult</code>ã¯<code>MainActivity</code>ã®æ‹¡å¼µé–¢æ•°ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã®ç‚ºã€<code>MainActivityPermissionsDispatcher</code>ã‚¯ãƒ©ã‚¹ãŒãªããªã‚Šã¾ã—ãŸã€‚(Javaã®æ–¹ã§ã¯å­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚)</p>

<h2>ãªã‚“ã§ã“ã‚“ãªå¤‰æ›´ã«ãªã£ãŸã®ã‹ï¼Ÿ</h2>

<h3>Kotlinã®æ‹¡å¼µé–¢æ•°</h3>

<p><a href="https://github.com/square/kotlinpoet">KotlinPoet</a>ã®å‡ºç¾ã‹ã‚‰ã€ã“ã‚Œã‚’ä½¿ã£ã¦Kotlinã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã—ã¦ã¿ã‚ˆã†->ã©ã†ã›ãªã‚‰Kotlinã£ã½ãæ‹¡å¼µé–¢æ•°ã«ã—ã¦ã¿ã‚ˆã†ï¼ã¨ã„ã†æµã‚Œã§æ‹¡å¼µé–¢æ•°ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚</p>

<p>è©³ç´°ã¯ä»¥ä¸‹ã®Issueã‚’ç¢ºèªã—ã¦ã¿ã¦ä¸‹ã•ã„ã€‚</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/320">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/320</a></p>

<h3>XxxWithPermissionCheckã¸ã®ãƒªãƒãƒ¼ãƒ </h3>

<p>ä»¥ä¸‹ã®Issueã§å•é¡Œæèµ·ã•ã‚Œã¾ã—ãŸã€‚</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/355">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/355</a></p>

<p>ã“ã®Issueã§ã¯æ¼ ç„¶ã¨ã—ãŸè³ªå•ã§ã—ãŸãŒã€Kotlinãƒ¦ãƒ¼ã‚¶ã«å¯¾ã—ã¦ã€æ‹¡å¼µé–¢æ•°ã¨ã—ã¦æä¾›ã™ã‚‹å ´åˆã€<code>WithCheck</code>ã§ã¯æ„å‘³ãŒã‚ã‹ã‚‰ãªã„ã®ã§ã¯ãªã„ã‹ï¼Ÿã¨ã„ã†è©±ã‹ã‚‰ä¸€æ°—ã«v3.0ã«å°å…¥ã™ã‚‹æµã‚Œã«ãªã‚Šã¾ã—ãŸã€‚</p>

<h2>æ‡¸å¿µäº‹é …</h2>

<h3>Kotlinå‘ã‘ã®lint</h3>

<p>PermissionsDispatcherã¯ã‚«ã‚¹ã‚¿ãƒ lintã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€Kotlinå®Ÿè£…å‘ã‘ã®lintã®å¯¾å¿œãŒã¾ã çµ‚ã‚ã£ã¦ã„ã¾ã›ã‚“ã€‚(å®Ÿéš›ã®å•é¡Œã¯UASTã®Kotlinå¯¾å¿œ)</p>

<p>ã“ã®ä»¶ã«é–¢ã™ã‚‹Issueã¯ä»¥ä¸‹</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/373">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/373</a></p>

<h3>Intellij Plugin</h3>

<p><a href="https://github.com/permissions-dispatcher/permissions-dispatcher-plugin">permissions-dispatcher-plugin</a>ã¨è¨€ã†Intellijãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ãŒã€ãƒ¡ã‚¤ãƒ³é–‹ç™ºè€…ã® <a href="https://github.com/shiraji">@shiraji</a> ãŒã‚µãƒœã£ã¦ã„ã‚‹ç‚ºã€v3å¯¾å¿œãŒã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãŸ<a href="https://github.com/permissions-dispatcher/permissions-dispatcher-plugin/issues/79#issuecomment-346983436">ã‚‚ã†v2ã®å¯¾å¿œã—ãªãã¦è‰¯ãã­ï¼Ÿ</a>ã¨è¨€ã£ã¦ãŠã‚Šã€èª°ã‹ã‚‰ã‚‚åè«–ãŒãªã„ç‚ºã€æ€¥ã«v3ã®ã¿ã®ã‚µãƒãƒ¼ãƒˆã«ãªã‚‹äºˆå®šã§ã™ã€‚</p>

<p>ãã‚“ãªã«ã„ãªã„ã¨æ€ã„ã¾ã™ãŒãƒ»ãƒ»ãƒ»ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã¦ã€v2ã®ã¿ã—ã‹ä½¿ã£ã¦ã„ãªã„äººã¯ã“ã‚Œã‚’æ©Ÿã«v3ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚å¤šåˆ†ä»Šå¹´åº¦ä¸­ã«ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ–¹ã‚‚å¯¾å¿œã—ã¾ã™ã€‚</p>

<h2>ã‚ã‚“ã¾ã‚Šåˆ©ç”¨è€…é–¢ä¿‚ãªã„è©±</h2>

<h3>permissions-dispatcher orgãŒå‡ºæ¥ãŸ</h3>

<p><a href="https://github.com/hotchemi">@hotchemi</a>ã•ã‚“ã‹ã‚‰ã®ææ¡ˆã§ã€permissions-dispatcher orgãŒå‡ºæ¥ã¾ã—ãŸã€‚ãŠã‹ã’æ§˜ã§ã€ã¾ã™ã¾ã™ãƒ¡ãƒ³ãƒ†ãƒŠã¨ã—ã¦é ‘å¼µã‚ŠãŸã„ï¼ã¨æ€ãˆã‚‹ã‚ˆã†ã«ã€‚ä»¥ä¸‹ãŒãã®Issue</p>

<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/353">https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/353</a></p>

<p>æ•°æ—¥å‰ã«ã‚ã£ãŸ<a href="http://hotchemi.hateblo.jp/entry/2017/12/03/003912">PermissionsDispatcherã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ</a>ã«ã‚‚åŒã˜ã‚ˆã†ãªã“ã¨ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚</p>

<h3>æŒ™å‹•ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å¢—ã‚„ã—ãŸ</h3>

<p>7æœˆã«æ›¸ã„ãŸ<a href="http://shiraji.github.io/blog/2017/07/14/testing-against-annotation-processing/">Testing Against Annotation Processing</a>ã«è©³ç´°æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã€èª­ã‚“ã§ãã ã•ã„!!!</p>

<h2>KotlinPoetã«é–¢ã—ã¦</h2>

<p>PermissionsDispatcherã®<a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/tree/123e50a184e058ad6b4adb0b659a343d79813913/processor/src/main/kotlin/permissions/dispatcher/processor/impl/kotlin">ã“ã®è¾ºã‚Š</a>ã‚’çœºã‚ã‚‹ã¨KotlinPoetã®å®Ÿè£…ã®å‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚<a href="https://qiita.com/advent-calendar/2017/kotlin">Kotlin Advent Calendar</a> ã®16æ—¥ç›®ã«KotlinPoetã«é–¢ã™ã‚‹æŠ•ç¨¿ãŒã•ã‚Œã‚‹ã®ã§ã€ãã¡ã‚‰ã‚‚å‚ç…§ã—ã¦ä¸‹ã•ã„ã€‚</p>

<h2>æœ€å¾Œã«</h2>

<p>PermissionsDispatcherã¯éå¸¸ã«è‰¯ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€æ–°ã—ã„ä»•çµ„ã¿ã‚‚ç©æ¥µçš„ã«å–ã‚Šå…¥ã‚Œã¦ã„ã¾ã™ã€‚ä¸€ç·’ã«é–‹ç™ºã—ã¾ã›ã‚“ã‹ï¼Ÿ</p>

<p>ã¾ãŸã€æœ€è¿‘ã€ãƒ“ãƒ«ãƒ‰å‡ºæ¥ãªã„ã€‚ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„ã€‚ãªã©ãªã©READMEèª­ã‚“ã§ã¾ã›ã‚“çš„ãªissueã«ä¸ŠãŒã£ã¦ãã¾ã™ã€‚ã“ã‚Œã®å¯¾å¿œã«æ™‚é–“ã‚’å‰²ã„ã¦ã—ã¾ã„ã€é–‹ç™ºãŒæ»ã‚Šã‚¬ãƒã§ã™ã€‚ã‚‚ã—ã€PermissionsDispatcherã«å¯¾ã—ã¦ä½•ã‹è²¢çŒ®ã—ãŸã„ï¼ã¨è¨€ã†æ–¹ã¯ã€ ã“ã®ã‚ˆã†ãªissueã®å¯¾å¿œã‚„èª¿æŸ»ãªã©ãªã©ãŠæ‰‹ä¼ã„ã—ã¦é ‚ã‘ã‚‹ã¨éå¸¸ã«åŠ©ã‹ã‚Šã¾ã™ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Visualize Kotlin substringXxx Methods]]></title>
    <link href="http://shiraji.github.io/blog/2017/06/19/string-dot-substring-methods/"/>
    <updated>2017-06-19T04:41:47+09:00</updated>
    <id>http://shiraji.github.io/blog/2017/06/19/string-dot-substring-methods</id>
    <content type="html"><![CDATA[<p>I found very hard time to memorize the following methods.</p>

<ul>
<li>substringAfter</li>
<li>substringAfterLast</li>
<li>substringBefore</li>
<li>substringBeforeLast</li>
</ul>


<p>Here is the visuals that illustrate the differences between these methods.</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h2>substringAfter</h2>

<p><code>substringAfter</code> tries to find the character(s) from &ldquo;beginning&rdquo;, and substrings &ldquo;after&rdquo; the characters</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/substrings/substringAfter.png" alt="substringAfter" /></p>

<h2>substringAfterLast</h2>

<p><code>substringAfterLast</code> tries to find the character(s) from &ldquo;last&rdquo;, and substrings &ldquo;after&rdquo; the characters</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/substrings/substringAfterLast.png" alt="substringAfterLast" /></p>

<h2>substringBefore</h2>

<p><code>substringBefore</code> tries to find the character(s) from &ldquo;beginning&rdquo;, and substrings &ldquo;before&rdquo; the characters</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/substrings/substringBefore.png" alt="substringBefore" /></p>

<h2>substringBeforeLast</h2>

<p><code>substringBeforeLast</code> tries to find the character(s) from &ldquo;last&rdquo;, and substrings &ldquo;before&rdquo; the characters</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/substrings/substringBeforeLast.png" alt="substringBeforeLast" /></p>

<h1>Text Summary</h1>

<p>The following list is the summary of these methods.</p>

<ul>
<li>&ldquo;Last&rdquo; -> find a match from the end</li>
<li>no &ldquo;Last&rdquo; -> find a match from the beginning</li>
<li>&ldquo;Before&rdquo; -> get all text before the match</li>
<li>&ldquo;After&rdquo; -> get all text after the match</li>
<li>The substring result does not include the matched text</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Extend Alt+Enter]]></title>
    <link href="http://shiraji.github.io/blog/2016/12/17/how-to-extend-alt+enter/"/>
    <updated>2016-12-17T00:00:01+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/12/17/how-to-extend-alt+enter</id>
    <content type="html"><![CDATA[<p>ã“ã®è¨˜äº‹ã¯<a href="http://qiita.com/advent-calendar/2016/jetbrains">JetBrains Advent Calendar 2016</a>ã®12/17ã®è¨˜äº‹ã§ã™ã€‚</p>

<p>Intellij IDEAã ã‘ã§ã¯ãªã„ã®ã§ã™ãŒã€Alt+Enter(Intention)ã¯è‡ªåˆ†ã§æ‹¡å¼µã—ãŸã‚‚ã®ã‚’ä½œã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>




<!-- more -->


<h1>è‡ªå·±ç´¹ä»‹</h1>

<p>è‡ªåˆ†ã®ãƒšãƒ¼ã‚¸ã«ãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹Intellijãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãŒãƒšãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸã‚‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºè¾ã‚ã‚ˆã†ã¨èª“ã£ã¦ã„ã¦ã€æœ€è¿‘ä¸­ã®äººã¨è©±ã—ãŸã‚‰ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ©Ÿèƒ½ãªã„ã‘ã©ï¼Ÿï½—ã¨ç”Ÿæ¶¯ç¾å½¹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºè€…ã¨ã—ã¦ã‚„ã£ã¦ã„ãã“ã¨ãŒæ±ºå®šã—ãŸäººé–“ã§ã™ã€‚</p>

<p>Intentionã ã‘ã§ã¯ãªãã€Inspectionãªã©ã‚‚ä½œæˆã—ã¦ãŠã‚Šã€Kotlinã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚‚ã—ã¦ã„ã¾ã™ã€‚Kotlinã®ä¸»ãªã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚‚Inspection/Intentionãªã®ã§ã€ã‚ã‚‹ç¨‹åº¦èª¬æ˜å‡ºæ¥ã‚‹ãƒ¬ãƒ™ãƒ«ã ã¨æ€ã„ã¾ã™ã€‚</p>

<h1>æƒ³å®šèª­è€…</h1>

<ul>
<li>Intentionã‚’ä½œã£ã¦ã¿ãŸã„</li>
<li>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã«èˆˆå‘³ãŒã‚ã‚‹</li>
<li>Intellijã®æ©Ÿèƒ½ã‚’ã‚ã‚‹ç¨‹åº¦ç†è§£ã—ã¦ã„ã‚‹</li>
<li>kotlinã®æ–‡æ³•ãŒãã‚Œãªã‚Šã«ç†è§£ã§ãã‚‹</li>
</ul>


<h1>Custom Intentionã‚’ä½œã£ã¦ã¿ã‚‹</h1>

<p>ä»Šå›ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ã€Intentionå‘¨ã‚Šã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚
<a href="https://plugins.jetbrains.com/plugin/9271">https://plugins.jetbrains.com/plugin/9271</a></p>

<p>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
<a href="https://github.com/shiraji/databinding-support">https://github.com/shiraji/databinding-support</a></p>

<p>ã“ã‚Œã‚’ãƒ™ãƒ¼ã‚¹ã«XMLãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®Intentionã®èª¬æ˜ã‚’ã—ã¾ã™ã€‚</p>

<p>ä»Šå›ã¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Šã€<code>&lt;layout&gt;</code>ã‚¿ã‚°ãŒrootã‚¿ã‚°ã§ã¯ãªã‹ã£ãŸå ´åˆã€<code>&lt;layout&gt;</code>ã‚¿ã‚°ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã¨ã„ã†Intentionã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<p><img src="https://raw.githubusercontent.com/shiraji/databinding-support/master/websites/images/wrap.gif" alt="wrap" /></p>

<p>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œæˆæ–¹æ³•ãªã©ã¯å‚è€ƒãƒªãƒ³ã‚¯ã«ã¾ã¨ã‚ã¦ã‚ã‚Šã¾ã™ã®ã§ã€ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„ã€‚</p>

<h2>Intentionã‚¯ãƒ©ã‚¹</h2>

<p><code>IntentionAction</code>ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

<h3><code>getText(): String</code></h3>

<p>popupã§è¡¨ç¤ºã•ã‚Œã‚‹æ™‚ã®æ–‡å­—åˆ—</p>

<h3><code>getFamilyName(): String</code></h3>

<p>ã‚ˆãã‚ã‹ã‚‰ã­ï½—(intellij-community/kotlin repoå†…ã§ã‚‚getTextå‘¼ã³å‡ºã—ã¦ã‚‹ã ã‘ã®ã¨ã“ã‚ãŒå¤šã„ã€‚)</p>

<h3><code>startInWriteAction(): Boolean</code></h3>

<p>Write Actionå†…ã§å®Ÿè¡Œã™ã‚‹ã‹ã©ã†ã‹ã€‚</p>

<h3><code>isAvailable(project: Project, editor: Editor?, file: PsiFile?): Boolean</code></h3>

<p>ãã®Intentionã‚’åˆ©ç”¨å¯èƒ½ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹</p>

<h3><code>invoke(project: Project, editor: Editor?, file: PsiFile?)</code></h3>

<p>IntentionãŒé¸æŠæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã€‚</p>

<p>ä»Šå›ã¯å®Ÿéš›ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã‚Šã¾ã—ãŸã€‚</p>

<pre><code class="kotlin">package com.github.shiraji.databindinglayout.intentions

class ConvertToDatabindingLayoutIntention : IntentionAction {

    override fun getText() = "Convert to databinding layout"
    override fun getFamilyName() = "Convert to databinding layout"
    override fun startInWriteAction() = true

    override fun isAvailable(project: Project, editor: Editor?, file: PsiFile?): Boolean {
        // rootã‚¿ã‚°ãŒlayoutã§ã¯ãªãã€androidã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã©ã†ã‹ã‚’åˆ¤å®šã€‚
    }

    override fun invoke(project: Project, editor: Editor?, file: PsiFile?) {
        // æ–°è¦&lt;layout&gt;ã‚¿ã‚°ã‚’ä½œæˆã—ã€å¿…è¦ãªattributeã‚’è¿½åŠ ã—ã€root tagã¨ã™ã‚‹ã€‚
    }

}
</code></pre>

<p><a href="https://github.com/shiraji/databinding-support/blob/1.0.2/src/main/kotlin/com/github/shiraji/databindinglayout/intentions/ConvertToDatabindingLayoutIntention.kt">https://github.com/shiraji/databinding-support/blob/1.0.2/src/main/kotlin/com/github/shiraji/databindinglayout/intentions/ConvertToDatabindingLayoutIntention.kt</a></p>

<p>ã“ã®rootã‚¿ã‚°ã‹ã©ã†ã‹ã¨ã‹ã€androidã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã©ã†ã‹ã®åˆ¤å®šã¨ã‹ã€ä½•ã‚’ã©ã†æ›¸ãæ›ãˆã‚‹ã®ã‹ã¨ã‹ãŒãŸã¶ã‚“ä¸€ç•ªé›£ã—ã„éƒ¨åˆ†ã ã¨æ€ã„ã¾ã™ã€‚ãŸã ã€ã“ã“ã¯ãã‚Œãã‚Œã®Intentionã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§é•ã†ã®ã§ã‚³ãƒ¼ãƒ‰èª­ã‚“ã§é ‘å¼µã‚Œï½—ã¨ã—ã‹è¨€ãˆã¾ã›ã‚“ã€‚ã€‚ã€‚</p>

<p>å”¯ä¸€ã‚ã‚‹å…±é€šç‚¹ã¨ã—ã¦ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã®èª­ã¿è¾¼ã¿ã‚„è§£æã¯Psiã‚’ä½¿ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€xmlã‚¿ã‚°ã ã£ãŸã‚‰<a href="https://github.com/JetBrains/intellij-community/blob/master/xml/xml-psi-api/src/com/intellij/psi/xml/XmlTag.java">XmlTag</a>ã€<a href="https://github.com/JetBrains/intellij-community/blob/master/xml/xml-psi-api/src/com/intellij/psi/xml/XmlAttribute.java">XmlAttribute</a>ã‚’ä½¿ã„ã¾ã™ã€‚<code>PsiElement#replace()</code>ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ç½®æ›ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚</p>

<p>ãã‚Œãã‚Œã®Elementä½œæˆãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—æ¯ã«FactoryãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚Xmlãªã‚‰<code>XmlElementFactory</code>ã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚Javaã®å ´åˆã ã¨<code>PsiElementFactory</code>ã ã—ã€Kotlinãªã‚‰<code>KtPsiFactory</code>ã‚’ä½¿ã„ã¾ã™ã€‚</p>

<h2>plugin.xml</h2>

<p>Intentionã‚¯ãƒ©ã‚¹ã‚’plugin.xmlã«å®šç¾©ã—ã¾ã™ã€‚</p>

<pre><code class="xml">        &lt;intentionAction&gt;
            &lt;className&gt;com.github.shiraji.databindinglayout.intentions.ConvertToDatabindingLayoutIntention&lt;/className&gt;
            &lt;category&gt;Android&lt;/category&gt;
        &lt;/intentionAction&gt;
</code></pre>

<p><a href="https://github.com/shiraji/databinding-support/blob/1.0.2/src/main/resources/META-INF/plugin.xml#L31-L34">https://github.com/shiraji/databinding-support/blob/1.0.2/src/main/resources/META-INF/plugin.xml#L31-L34</a></p>

<h2>Intentionã®èª¬æ˜æ–‡ã‚’æ›¸ã</h2>

<p>è‡ªåˆ†ã¯ã¡ã‚‡ãã¡ã‚‡ãå¿˜ã‚Œã‚‹ã®ã§ã™ãŒãƒ»ãƒ»ãƒ»(å®Ÿéš›ã“ã‚Œã‚’å¿˜ã‚Œã¦ã€1.0.1->1.0.2ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‚’ã—ãŸã€‚)</p>

<p>ã“ã‚“ãªæ„Ÿã˜ã§è¨­å®šç”»é¢ã«èª¬æ˜æ–‡ã‚’æ›¸ãã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-create-custom-intention/intention_setting.gif" alt="intention_settings" /></p>

<p>ä»¥ä¸‹ã®3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<ul>
<li>after.xml.template</li>
<li>before.xml.template</li>
<li>description.html</li>
</ul>


<p>ãã‚Œãã‚ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã¯ã“ã“ã§ã™ã€‚</p>

<p><img src="https://raw.githubusercontent.com/wiki/shiraji/images/blog/images/how-to-create-custom-intention/intention_desc.png" alt="intention_desc" /></p>

<p>ä¾‹ãˆã°ã€Javaãƒ•ã‚¡ã‚¤ãƒ«ã®ã®Intentionã ã£ãŸå ´åˆã€<code>after.java.template</code>ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’<code>after.{æ‹¡å¼µå­}.template</code>ã¨ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚<code>before</code>ã®ã»ã†ã‚‚åŒã˜ã§ã™ã€‚</p>

<p>é…ç½®ç®‡æ‰€ã¯<code>resourcesãƒ•ã‚©ãƒ«ãƒ€/intentionDescriptions/INTENSIONå/</code>ã«é…ç½®ã—ã¾ã™ã€‚</p>

<p><code>ConvertToDatabindingLayoutIntention</code>ã®å ´åˆã€ã“ã‚“ãªæ„Ÿã˜ã€‚</p>

<p><a href="https://github.com/shiraji/databinding-support/tree/1.0.2/src/main/resources/intentionDescriptions/ConvertToDatabindingLayoutIntention">https://github.com/shiraji/databinding-support/tree/1.0.2/src/main/resources/intentionDescriptions/ConvertToDatabindingLayoutIntention</a></p>

<h1>æœ€å¾Œã«</h1>

<p>Happy <code>alt+enter</code> life!</p>

<h1>å‚è€ƒãƒªãƒ³ã‚¯</h1>

<p>IntelliJ IDEAã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ â€“ ã‚¤ãƒ³ãƒ†ãƒ³ã‚·ãƒ§ãƒ³</p>

<p><a href="http://samuraism.com/products/jetbrains/intellij-idea/quickstart/intentions">http://samuraism.com/products/jetbrains/intellij-idea/quickstart/intentions</a></p>

<p>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆæ‰‹é †</p>

<p><a href="http://www.jetbrains.org/intellij/sdk/docs/index.html">http://www.jetbrains.org/intellij/sdk/docs/index.html</a></p>

<p>gradleã‚’ä½¿ã†å ´åˆ</p>

<p><a href="http://www.jetbrains.org/intellij/sdk/docs/tutorials/build_system.html?search=gradle">http://www.jetbrains.org/intellij/sdk/docs/tutorials/build_system.html?search=gradle</a></p>

<p>ã“ã®gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã¯ãªã„ã®ã§ã€gradle-intellij-plugin wizardã‚’ä½¿ã†ã¨ä¾¿åˆ©ã ã‚ˆ(ã‚¹ãƒ†ãƒ)</p>

<p><a href="https://plugins.jetbrains.com/plugin/8450">https://plugins.jetbrains.com/plugin/8450</a></p>
]]></content>
  </entry>
  
</feed>
