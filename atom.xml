<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Shiraji's Blog]]></title>
  <link href="http://shiraji.github.io/atom.xml" rel="self"/>
  <link href="http://shiraji.github.io/"/>
  <updated>2016-03-01T08:24:36+09:00</updated>
  <id>http://shiraji.github.io/</id>
  <author>
    <name><![CDATA[Shiraji]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ForwardingAstVisitor's Life Cycle (Android Lint)]]></title>
    <link href="http://shiraji.github.io/blog/2016/02/24/forwardingAstVisitor/"/>
    <updated>2016-02-24T14:37:58+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/02/24/forwardingAstVisitor</id>
    <content type="html"><![CDATA[<h1>Summary</h1>

<ul>
<li><code>ForwardingAstVisitor</code> has life cycle</li>
<li>visitXxx -> afterXxx -> endXxx</li>
<li>Begin <code>visitCompilationUnit</code>, End <code>afterVisitCompilationUnit</code></li>
<li>Go from top to bottom. No surprise, except annotation.</li>
<li>Does not talk about visitIf or any of visitXxx where Xxx is keyword</li>
</ul>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h1>Motivation</h1>

<p>The past few weeks, I am working on creating custom lints for <a href="https://github.com/hotchemi/PermissionsDispatcher">PermissionsDispatcher</a>.</p>

<p>Using <code>ForwardingAstVisitor</code> is the easiest way to implement custom lint. I found there are 75 &ldquo;visit&rdquo; methods in the class. For instance, <code>visitMethodDeclaration</code> is called for iterating all method declarations. <code>visitIdentifier</code> is for all identifiers. Trust me, there is even <code>visitIf</code> and <code>visitSwitch</code> that are called for each <code>if</code> and <code>switch</code>.</p>

<p>However, I could not find any documentations that describes which &ldquo;visit&rdquo; method comes first. So&hellip;this is the post that describes what is the &ldquo;lifecycle&rdquo; of <code>ForwardingAstVisitor</code>.</p>

<h1>Basic Rules</h1>

<p>There are 4 types of methods, <code>visit</code>, <code>visitNode</code>, <code>afterVisit</code>, <code>endVisit</code> for <code>ForwardingAstVisitor</code>.</p>

<ul>
<li><code>visitXxx</code> comes first</li>
<li><code>visitNode</code> comes second for dive into the node</li>
<li><code>afterVisitXxx</code> comes if there is no more method call inside <code>visitXxx</code></li>
<li>Finally, <code>endVisit</code> comes for wrap up.</li>
</ul>


<p>For instance, followings are the method call for checking <code>@Override</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>visitAnnotation                     : target node -&gt; @Override
</span><span class='line'>| visitNode                         : target node -&gt; @Override
</span><span class='line'>| | visitTypeReference              : target node -&gt; Override
</span><span class='line'>| | | visitNode                     : target node -&gt; Override
</span><span class='line'>| | | | visitTypeReferencePart      : target node -&gt; Override
</span><span class='line'>| | | | | visitNode                 : target node -&gt; Override
</span><span class='line'>| | | | | | visitIdentifier         : target node -&gt; Override
</span><span class='line'>| | | | | | | visitNode             : target node -&gt; Override
</span><span class='line'>| | | | | | afterVisitIdentifier    : target node -&gt; Override
</span><span class='line'>| | | | | endVisit                  : target node -&gt; Override
</span><span class='line'>| | | | afterVisitTypeReferencePart : target node -&gt; Override
</span><span class='line'>| | | endVisit                      : target node -&gt; Override
</span><span class='line'>| | afterVisitTypeReference         : target node -&gt; Override
</span><span class='line'>| endVisit                          : target node -&gt; Override
</span><span class='line'>afterVisitAnnotation                : target node -&gt; @Override</span></code></pre></td></tr></table></div></figure>


<h1>General Rules</h1>

<p>Now, let see what&rsquo;s happens if I want to lint check for a Java file.</p>

<p>Assuming I am going to check following class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="kn">package</span> <span class="n">pkg</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.Manifest</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">permissions.dispatcher.NeedsPermission</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">permissions.dispatcher.RuntimePermissions</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@RuntimePermissions</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@NeedsPermission</span><span class="o">(</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">)</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">showCamera</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestPermissionsResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">permissions</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">grantResults</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onRequestPermissionsResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">permissions</span><span class="o">,</span> <span class="n">grantResults</span><span class="o">);</span>
</span><span class='line'>        <span class="n">MainActivityPermissionsDispatcher</span><span class="o">.</span><span class="na">onRequestPermissionsResult</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">grantResults</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the <a href="https://gist.github.com/shiraji/dc4665d704d8852243c3">debuging code</a>. It&rsquo;s basically Sys-out method name and <code>node</code> parameter. And the output is <a href="https://gist.github.com/shiraji/37993e824c36e31724d5">this</a></p>

<p>OK, Too long&hellip;let me summarize idea.</p>

<ul>
<li>The first visit-method is <code>visitCompilationUnit</code></li>
<li>Next it checks <code>visitPackageDeclaration</code> for <code>package pkg;</code> (Meaning, it starts from the first line of the class)</li>
<li>And goes one by one until it reaches the bottom of the class</li>
<li>The last after-method is <code>afterVisitCompilationUnit</code></li>
</ul>


<h1>Exceptional Rules</h1>

<p>Now, we know the lint checks goes the top to the bottom. However, there is an exception, Annotation.</p>

<p><code>@RuntimePermissions</code> which is located the above of the class declaration in the example above.</p>

<p>Actually, when we run the lint checks, <code>visitClassDeclaration</code> comes <a href="https://gist.github.com/shiraji/37993e824c36e31724d5#file-output-txt-L127">first</a> and then <code>visitAnnotation</code> comes <a href="https://gist.github.com/shiraji/37993e824c36e31724d5#file-output-txt-L167">later</a>.</p>

<p>It seems that the lint handles annotation as a node inside of method declaration.</p>

<p>For example, if we want to store class declaration object which <code>@RuntimePermissions</code>, we cannot do followings:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">ClassDeclaration</span><span class="o">&gt;</span> <span class="n">classDeclarations</span><span class="o">;</span>
</span><span class='line'><span class="kt">boolean</span> <span class="n">hasRuntimePermisions</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">visitAnnotation</span><span class="o">(</span><span class="n">Annotation</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">astAnnotationTypeReference</span><span class="o">().</span><span class="na">getTypeName</span><span class="o">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="s">&quot;permissions.dispatcher.RuntimePermissions&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">hasRuntimePermisions</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">visitAnnotation</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">visitClassDeclaration</span><span class="o">(</span><span class="n">ClassDeclaration</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="n">hasRuntimePermisions</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">classDeclarations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">visitClassDeclaration</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead, I would use <code>afterVisitClassDeclaration</code> and call <code>requestRepeat</code> to run other detector which uses class declaration objects.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="n">JavaContext</span> <span class="n">context</span><span class="o">;</span>
</span><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">ClassDeclaration</span><span class="o">&gt;</span> <span class="n">classDeclarations</span><span class="o">;</span>
</span><span class='line'><span class="kt">boolean</span> <span class="n">hasRuntimePermisions</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">visitAnnotation</span><span class="o">(</span><span class="n">Annotation</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">astAnnotationTypeReference</span><span class="o">().</span><span class="na">getTypeName</span><span class="o">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="s">&quot;permissions.dispatcher.RuntimePermissions&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">hasRuntimePermisions</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">visitAnnotation</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterVisitClassDeclaration</span><span class="o">(</span><span class="n">ClassDeclaration</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="n">hasRuntimePermisions</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">classDeclarations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span><span class='line'>        <span class="n">context</span><span class="o">.</span><span class="na">requestRepeat</span><span class="o">(</span><span class="k">new</span> <span class="nf">MyOtherDetector</span><span class="o">(),</span> <span class="n">EnumSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">Scope</span><span class="o">.</span><span class="na">ALL_JAVA_FILES</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">visitClassDeclaration</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Custom Lint for Library]]></title>
    <link href="http://shiraji.github.io/blog/2016/02/17/custom-lint-for-library/"/>
    <updated>2016-02-17T03:00:00+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/02/17/custom-lint-for-library</id>
    <content type="html"><![CDATA[<h1>Summary</h1>

<ul>
<li>PermissionsDispatcher now have a custom lint</li>
<li>Adding custom lint is not that hard</li>
<li>LintDetectorTest&hellip;? Forget it</li>
</ul>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h1>PermissionsDispatcher now have a custom lint</h1>

<p>First of all, I am one of collaborators of <a href="https://github.com/hotchemi/PermissionsDispatcher">PermissionsDispatcher</a> which makes developers handle runtime permissions very easily.</p>

<p>PermissionsDispatcher now have a custom lint for its library. Initial issue came from <a href="https://github.com/hotchemi/PermissionsDispatcher/issues/56#issuecomment-163499243">this comment</a>.</p>

<p>The library requires the developer to define a method with <code>@NeedsPermission</code>. Like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@NeedsPermission</span><span class="o">(</span><span class="n">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">)</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">showCamera</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, this method should not directly access. Instead, the developers must use a method that PermissionsDispatcher generated.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">MainActivityPermissionsDispatcher</span><span class="o">.</span><span class="na">showCameraWithCheck</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> <span class="c1">// Yes</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">foo2</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">showCamera</span><span class="o">();</span> <span class="c1">// No!</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to make sure the developers did not call this method, we decide to provide custom lint for this library.</p>

<h1>How to add custom lint for library</h1>

<p>To create custom lint for Android application, check links below</p>

<ul>
<li><a href="http://tools.android.com/tips/lint-custom-rules">Writing Custom Lint Rules</a></li>
<li><a href="http://tools.android.com/tips/lint/writing-a-lint-check">Writing a Lint Check</a></li>
<li><a href="http://qiita.com/hotchemi/items/9364d54a0e024a5e6275">@hotchime&rsquo;s blog post at qiita</a> (For Japanese developer)</li>
</ul>


<p>Custom lint for library needs extra settings to inject <code>lint.jar</code> to its .aar file</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">configurations</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">lintChecks</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// we have lint module with lintCheck configuration.</span>
</span><span class='line'>    <span class="c1">// check this file: https://github.com/shiraji/PermissionsDispatcher/blob/master/lint/build.gradle</span>
</span><span class='line'>    <span class="n">lintChecks</span> <span class="nf">project</span><span class="o">(</span><span class="nl">path:</span> <span class="s1">&#39;:lint&#39;</span><span class="o">,</span> <span class="nl">configuration:</span> <span class="s1">&#39;lintChecks&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">assemble</span><span class="o">.</span><span class="na">doLast</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">copyJarToOtherModules</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">task</span> <span class="nf">copyLintJar</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Copy</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">from</span><span class="o">(</span><span class="n">configurations</span><span class="o">.</span><span class="na">lintChecks</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">rename</span> <span class="o">{</span> <span class="s1">&#39;lint.jar&#39;</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">into</span> <span class="s1">&#39;build/intermediates/lint/&#39;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">project</span><span class="o">.</span><span class="na">afterEvaluate</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">compileLintTask</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="s1">&#39;compileLint&#39;</span> <span class="o">}</span>
</span><span class='line'>    <span class="n">compileLintTask</span><span class="o">.</span><span class="na">dependsOn</span><span class="o">(</span><span class="n">copyLintJar</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically, if there is <code>compileLint</code> task, then make the task depends on <code>copyLintJar</code> task which copies <code>lint.jar</code> to <code>build/intermediates/lint/</code></p>

<p>The user of this library doesn&rsquo;t need to put lint.jar to <code>.android/lint/</code>. Just sync library and then run <code>./gradlew lint</code></p>

<h1>Use LintDetectorTest</h1>

<p>Just don&rsquo;t.</p>

<p>Check this code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">root</span><span class="o">,</span>
</span><span class='line'>            <span class="s">&quot;tools/base/lint/libs/lint-tests/src/test/java/&quot;</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="sc">&#39;/&#39;</span><span class="o">,</span> <span class="n">File</span><span class="o">.</span><span class="na">separatorChar</span><span class="o">)</span>
</span><span class='line'>            <span class="o">+</span> <span class="n">pkg</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="sc">&#39;.&#39;</span><span class="o">,</span> <span class="n">File</span><span class="o">.</span><span class="na">separatorChar</span><span class="o">)</span>
</span><span class='line'>            <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separatorChar</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the code that reads from <code>$ROOT/tools/base/lint/libs/lint-tests/src/test/java/PACAKGE-NAME-REPLACE-DOT-WITH-SLASH</code>.
I believe most developers doesn&rsquo;t want to put project in the specific directory in order to pass the test cases.</p>

<p>Actually, current version of <code>LintDetectorTest</code> has a lots of problems with loading resources, java source and &ldquo;class&rdquo; file. (Yes! you need to supply .class file to run the test)</p>

<p>In order to use the <code>LintDetectorTest</code>, the developer must override <code>protected InputStream getTestResource(String relativePath, boolean expectExists)</code> like <a href="https://android.googlesource.com/platform/tools/base/+/master/lint/libs/lint-tests/src/test/java/com/android/tools/lint/checks/AbstractCheckTest.java?autodive=0%2F%2F%2F%2F%2F%2F%2F#49">what AOSP did</a></p>

<p><code>LintDetectorTest</code> is still Beta. I assumed there are a lot of work to make it production release.</p>

<p>If it comes to production, I hope it does not require me to pass .java/.class file like this way.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="n">lintFiles</span><span class="o">(</span><span class="s">&quot;MainActivity.class=&gt;pkg/MainActivity.class&quot;</span><span class="o">));</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Now how to test???</h1>

<p>I don&rsquo;t know.</p>

<p>The only way I came up is <a href="https://github.com/hotchemi/PermissionsDispatcher/pull/75#issuecomment-178650850">manual testing</a>.</p>

<p>So, someone who know better way to test lint, please let me know!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[アクセス修飾子次第で、メソッド数が増えてしまう問題について]]></title>
    <link href="http://shiraji.github.io/blog/2016/01/11/accessor/"/>
    <updated>2016-01-11T10:50:49+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/01/11/accessor</id>
    <content type="html"><![CDATA[<h1>まとめ</h1>

<p>privateアクセス修飾子をつけると条件次第で勝手にメソッド余分に生成されるから気をつけてね！</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h1>最初に</h1>

<p>Jakeさんがこの<a href="https://github.com/google/gson/pull/761">pull request</a>を投げていて、察するに$accessorというメソッドが生成されてしまうので、それを生成しないようにしたぜ？ってことだと思う。が、なんでそうなるのかわからない。
他にも、コンストラクタの修飾子を変更しているんだけど、これもなんのためなのかわからない。
そこで、コードを書いてみて、実際にやってみました。</p>

<p>このpull requestでは以下の４つを修正しています。</p>

<ul>
<li><a href="https://github.com/google/gson/pull/761/files#diff-694e40202daa75f0056c800b5d953297R88">コンストラクタのprivateの削除</a></li>
<li><a href="https://github.com/google/gson/pull/761/files#diff-a654cd1a9dadb8afb191e239a12e19a5R765">デフォルトコンストラクタの定義</a></li>
<li><a href="https://github.com/google/gson/pull/761/files#diff-0776314ca8e083ca3943426740d1dd69R245">メンバー変数のprivateの削除</a></li>
<li><a href="https://github.com/google/gson/pull/761/files#diff-0776314ca8e083ca3943426740d1dd69R465">メソッドのprivateの削除</a></li>
</ul>


<h1><a href="https://github.com/google/gson/pull/761/files#diff-694e40202daa75f0056c800b5d953297R88">コンストラクタのprivateの削除</a></h1>

<p>この変更がわかりやすいようにサンプルコードを作成してみました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">PrivateConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">AbstractInnerClass</span><span class="o">()</span> <span class="o">{}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="kd">extends</span> <span class="n">AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">DefaultConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">AbstractInnerClass</span><span class="o">()</span> <span class="o">{}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="kd">extends</span> <span class="n">AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>違いは、PrivateConstructor内にある、AbstractInnerClassのコンストラクタにprivateがあるかどうかです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">%</span> <span class="n">javap</span> <span class="o">-</span><span class="n">p</span> <span class="n">PrivateConstructor</span><span class="o">*.</span><span class="na">class</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateConstructor$1</span> <span class="o">{</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateConstructor.java&quot;</span>
</span><span class='line'><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">PrivateConstructor$AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">PrivateConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="nf">PrivateConstructor$AbstractInnerClass</span><span class="o">(</span><span class="n">PrivateConstructor</span><span class="o">);</span>
</span><span class='line'>  <span class="n">PrivateConstructor$AbstractInnerClass</span><span class="o">(</span><span class="n">PrivateConstructor</span><span class="o">,</span> <span class="n">PrivateConstructor$1</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateConstructor$InnerClass</span> <span class="kd">extends</span> <span class="n">PrivateConstructor$AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">PrivateConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">PrivateConstructor$InnerClass</span><span class="o">(</span><span class="n">PrivateConstructor</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">PrivateConstructor</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">%</span> <span class="n">javap</span> <span class="o">-</span><span class="n">p</span> <span class="n">DefaultConstructor</span><span class="o">*.</span><span class="na">class</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;DefaultConstuctor.java&quot;</span>
</span><span class='line'><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">DefaultConstructor$AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">DefaultConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">DefaultConstructor$AbstractInnerClass</span><span class="o">(</span><span class="n">DefaultConstructor</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;DefaultConstuctor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">DefaultConstructor$InnerClass</span> <span class="kd">extends</span> <span class="n">DefaultConstructor$AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">DefaultConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">DefaultConstructor$InnerClass</span><span class="o">(</span><span class="n">DefaultConstructor</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;DefaultConstuctor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">DefaultConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">DefaultConstructor</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Javaファイル内では違いはprivateだけでしたが、classファイル内では、以下のメソッドが出来ています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">PrivateConstructor$AbstractInnerClass</span><span class="o">(</span><span class="n">PrivateConstructor</span><span class="o">,</span> <span class="n">PrivateConstructor$1</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>これが生成されることで、メソッド数がDefaultConstuctor.javaでは3つなのに、PrivateConstructor.javaでは4つになってしまいます。
なぜこうなるのかというと、PrivateConstructor$InnerClassが継承するために必要なコンストラクタを定義する必要があるためです。</p>

<p>実際こんなクラスを定義してみるとわかります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">PrivateConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">AbstractInnerClass</span><span class="o">()</span> <span class="o">{}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="c1">// class InnerClass extends AbstractInnerClass {</span>
</span><span class='line'>  <span class="c1">// }</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">%</span> <span class="n">javap</span> <span class="o">-</span><span class="n">p</span> <span class="n">PrivateConstructor</span><span class="o">*.</span><span class="na">class</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateConstructor.java&quot;</span>
</span><span class='line'><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">PrivateConstructor$AbstractInnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">PrivateConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="nf">PrivateConstructor$AbstractInnerClass</span><span class="o">(</span><span class="n">PrivateConstructor</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">PrivateConstructor</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>PrivateConstructor$AbstractInnerClassだけしか定義されておらず、privateのコンストラクタにアクセスする必要がないため、<code>PrivateConstructor$AbstractInnerClass(PrivateConstructor, PrivateConstructor$1);</code>は生成されません。</p>

<h1><a href="https://github.com/google/gson/pull/761/files#diff-a654cd1a9dadb8afb191e239a12e19a5R765">デフォルトコンストラクタの定義</a></h1>

<p>今回の修正で一番おもしろいのがこれです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">NoDefaultConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="kd">extends</span> <span class="n">AbstractClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これをコンパイルすると、以下のようになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;NoDefaultConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">NoDefaultConstructor$1</span> <span class="o">{</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;NoDefaultConstructor.java&quot;</span>
</span><span class='line'><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">NoDefaultConstructor$AbstractClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">NoDefaultConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="nf">NoDefaultConstructor$AbstractClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">);</span>
</span><span class='line'>  <span class="n">NoDefaultConstructor$AbstractClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">,</span> <span class="n">NoDefaultConstructor$1</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;NoDefaultConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">NoDefaultConstructor$InnerClass</span> <span class="kd">extends</span> <span class="n">NoDefaultConstructor$AbstractClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">NoDefaultConstructor</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">NoDefaultConstructor$InnerClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;NoDefaultConstructor.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">NoDefaultConstructor</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">NoDefaultConstructor</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>コンストラクタが生成されています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="nf">NoDefaultConstructor$AbstractClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">);</span>
</span><span class='line'><span class="n">NoDefaultConstructor$AbstractClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">,</span> <span class="n">NoDefaultConstructor$1</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Javaではコンストラクタを定義していない場合、デフォルトコンストラクタが生成されます。
しかし、そのデフォルトコンストラクタはclassのアクセス修飾子と同じものが定義されます。</p>

<p><code>AbstractClass</code>はprivateで定義されているため、privateのデフォルトコンストラクタが定義されます。それがこれ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="nf">NoDefaultConstructor$AbstractClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>それで、このコンストラクタにアクセスするためのコンストラクタを定義する必要があるので、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">NoDefaultConstructor$AbstractClass</span><span class="o">(</span><span class="n">NoDefaultConstructor</span><span class="o">,</span> <span class="n">NoDefaultConstructor$1</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>これが生成されます。</p>

<p>メソッドを0で定義していますが、実は4つのメソッドが出来ていました。
少なくともprivateのデフォルトコンストラクタはいらないので、空のデフォルトコンストラクタの変更を入れているわけです。</p>

<h1><a href="https://github.com/google/gson/pull/761/files#diff-0776314ca8e083ca3943426740d1dd69R245">メンバー変数のprivateの削除</a></h1>

<p>この変更も面白いです。</p>

<p>サンプルコードはこんな感じです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">DefaultMember</span> <span class="o">{</span>
</span><span class='line'>  <span class="kt">boolean</span> <span class="n">flag</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;DefaultMember.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">DefaultMember$InnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">DefaultMember</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">DefaultMember$InnerClass</span><span class="o">(</span><span class="n">DefaultMember</span><span class="o">);</span>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">foo</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;DefaultMember.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">DefaultMember</span> <span class="o">{</span>
</span><span class='line'>  <span class="kt">boolean</span> <span class="n">flag</span><span class="o">;</span>
</span><span class='line'>  <span class="n">DefaultMember</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">PrivateMember</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">flag</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateMember.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateMember$InnerClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">final</span> <span class="n">PrivateMember</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">PrivateMember$InnerClass</span><span class="o">(</span><span class="n">PrivateMember</span><span class="o">);</span>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">foo</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateMember.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateMember</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">flag</span><span class="o">;</span>
</span><span class='line'>  <span class="n">PrivateMember</span><span class="o">();</span>
</span><span class='line'>  <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">access$002</span><span class="o">(</span><span class="n">PrivateMember</span><span class="o">,</span> <span class="kt">boolean</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>こんなのが出来ています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">access$002</span><span class="o">(</span><span class="n">PrivateMember</span><span class="o">,</span> <span class="kt">boolean</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>これは、Innerクラスからflagにアクセスするためのメソッドです。
privateアクセス修飾子のため、アクセス出来ないので、accessというprefix付きのメソッドが生成されflagにアクセス出来るようにしています。</p>

<h1><a href="https://github.com/google/gson/pull/761/files#diff-0776314ca8e083ca3943426740d1dd69R465">メソッドのprivateの削除</a></h1>

<p>パターンパターン！ですけどメソッドのアクセス修飾子も同じです。</p>

<p>サンプルコードはこれ。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">PrivateMethod</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Object</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="kt">void</span> <span class="nf">bar</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">PrivateMethod</span> <span class="n">method</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">PrivateMethod</span><span class="o">();</span>
</span><span class='line'>        <span class="n">method</span><span class="o">.</span><span class="na">foo</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">};</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateMethod.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateMethod</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">PrivateMethod</span><span class="o">();</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">();</span>
</span><span class='line'>  <span class="kd">static</span> <span class="kt">void</span> <span class="nf">access$000</span><span class="o">(</span><span class="n">PrivateMethod</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{};</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これでprivateを外すとこうなります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">PrivateMethod</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Object</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="kt">void</span> <span class="nf">bar</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">PrivateMethod</span> <span class="n">method</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">PrivateMethod</span><span class="o">();</span>
</span><span class='line'>        <span class="n">method</span><span class="o">.</span><span class="na">foo</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">};</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;PrivateMethod.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">PrivateMethod</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">PrivateMethod</span><span class="o">();</span>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">foo</span><span class="o">();</span>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{};</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>static void access$000(PrivateMethod);</code>が減りました。
これもアクセスするために生成されたメソッドです。</p>

<h1>終わりに</h1>

<p>Javaのアプリケーションではそこまで影響度はないですが、Androidはメソッド65K問題があるので、メソッド数には注意が必要です。特に利用しているライブラリではメソッド数を減らそうという狙いがあったのだと思います。</p>

<p>Jakeさんは他にもこの自動生成されるメソッドの検出方法を<a href="https://github.com/google/gson/pull/761#issuecomment-167436875">コメント</a>しています。</p>

<p>Androiderは盲目的にprivateのアクセス修飾子にすればいいという考えは辞めたほうがいいようです。</p>

<p>ちなみにJakeさんは一つ<a href="https://gist.github.com/JakeWharton/5b3dbbc54c779a6bc6af">どうしようもない例</a>も出してくれてます。</p>

<p>これはメソッドを減らすことがどうやっても出来ないそうです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[プルリク駆動勉強]]></title>
    <link href="http://shiraji.github.io/blog/2016/01/10/pull_req_study/"/>
    <updated>2016-01-10T10:44:39+09:00</updated>
    <id>http://shiraji.github.io/blog/2016/01/10/pull_req_study</id>
    <content type="html"><![CDATA[<h1>まとめ</h1>

<p>勉強出来そうなプロジェクトを選らんで、pull requestを投げて、レビューしてもらうと勉強になるよ。</p>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h1>対象者</h1>

<ul>
<li>息をするようにpull requestを投げられない</li>
<li>プログラミングの基礎は勉強したけど、今度どうすればいいのわからない</li>
</ul>


<h1>プルリク駆動勉強とは</h1>

<p>30歳を超えて、会社では中堅になりました。昔は会社から与えられた仕事をこなすことによって成長を感じられていました。ここ数年は後輩に教えたり、リソース管理などをすることが多くなり、エンジニアとしての成長を感じられなくなってしまいました。(マネージメント力の成長は感じています。)このままではいかん！ということで、考え出したのがプルリク駆動勉強です。</p>

<p>プルリク駆動勉強とはpull requestを投げるためにそのプロジェクトを学んだり、英語でのコミュニケーションをしたり、その言語のベストプラクティスを体で覚えたりすることです。</p>

<p>とにかくpull requestを投げてレビューされることを目的にします。</p>

<p>pull request投げるなんて出来ない！怖い！って思うかもしれません。
確かに急に新しい機能の提案するのは中々通らないし、レビューすらしてくれないこともあります。しかし、すでにあるIssueのうち、プロジェクトオーナーが「これはやりたいけど、時間が〜」と言っているようなものはくそコードを投げつけてもしっかり受け止めてくれ、そのコードをより良いものに仕上げるようにアドバイスくれます。</p>

<p>このレビューが非常に良く、凄腕のエンジニアが無料でコードを見てくれてアドバイスまでくれるのでスキルアップに最適です。こっちは勉強のつもりなんですが、pull requestを送っただけで感謝されることだってあります。もしそのコードがマージなんてされちゃえば、有名どころのプロジェクトの一部が自分のコードで動くことになるわけです。これは嬉しい。</p>

<p>かといって、無闇やたらにpull requestを投げてもいいことはないので自分の経験からこれなら勉強出来る！というものを説明していきます。</p>

<h1>プルリク駆動勉強の条件</h1>

<p>自分は以下の条件でpull requestを投げるプロジェクトを選定をします。</p>

<ul>
<li>GitHubのスターが500以上。出来れば5000以上</li>
<li>開発が活発</li>
<li>Issueがラベルなどで管理されている</li>
<li>放置されているpull requestが少ない</li>
<li>GitHubで完結している</li>
<li>使ったことあるなしは気にしない</li>
</ul>


<h2>GitHubのスターが500↑</h2>

<p>GitHubのスターが多いものは注目度が高く、利用価値が高いです。またこういうプロジェクトの開発に関わっている人は技術レベルが高く、pull requestへのレビューもかなり厳しくなります。こういうプロジェクトにコントリビュート出来るとモチベーションアップにも繋がるため、有名どころを積極的に狙います。</p>

<p>ただし、有名どころだと「バグ報告はありがたいけど、いきなりコードのコントリビュートはしなくていい」と言うところもありますので、CONTRIBUTING.mdは注意して読んで下さい。</p>

<h2>開発が活発</h2>

<p>1年以上放置されているライブラリだとマージどころかレビューされない可能性が高くなります。それでは意味がないので、コードレビューがされているかどうかの確認は絶対行います。</p>

<p>マージ権限があるユーザ(Collaborator)が複数いるとかなり良いです。マージしているコミッターが複数いるかどうかをコミット履歴から追ってみるとわかります。</p>

<h2>Issueがラベルなどで管理されている</h2>

<p>有名どころのプロジェクトはリソースがないから対応していないIssueが結構あります。新参者がいきなりそういうIssueに対してpull requestを送るのは怖いと感じるはずです。(pull request投げるのに慣れると特段気にならなくなりますが。。。)</p>

<p>Issueが整理されているプロジェクトでは、誰がコントリビュートしてもいいよ！というラベルが貼ってある場合があります。例えば、自分がちょくちょくコントリビュートしている、<a href="https://github.com/excilys/androidannotations/">AndroidAnnotations</a>では<a href="https://github.com/excilys/androidannotations/labels/ContributionWelcome">ContributionWelcome</a>がそれに当たります。
こういうラベルがあれば、いつでもバッチコイやと宣言しているので、新参者だろうと特に気にせず、pull request投げてしまいます。大抵の場合、何をするべきかということがしっかりIssueに記載されていますので、その通りに実装すれば良いだけです。</p>

<p>ラベルが管理されていないところでも、Issueにこれやってもいいかね？というコメントをしてしまうのもありです。マージしている人が上げているようなIssueは特に狙い目で質問もしやすく、レスポンスも早いです。</p>

<h2>放置されているpull requestが少ない</h2>

<p>一ヶ月以上前に上げられたpull requestが10件以上放置されているようなプロジェクトは危険です。</p>

<p>大抵、pull requestはマージしてほしいから出しているわけで、コントリビューター側の問題で放置されるというのは稀です。プロジェクトオーナーがレビューしてくれない、マージする気がない、忙しいことが多く、そういうプロジェクトにpull requestを投げても放置されるだけで勉強出来ません。時間の無駄です。</p>

<h2>GitHubで完結している</h2>

<p>GitHub内で完結していないプロジェクトは避けます。Issueが別サイトであったり、sourceがcloneで一発取得できなかったりするものです。そのプロジェクト特有のローカルルールはラーニングコストが高いわりに学んでもそのプロジェクトでしか使えないためです。</p>

<p>どうしてもそのプロジェクトのコントリビュートがしたい！という人であれば、全力で推奨しますが、そういうプロジェクトは新参者に対しかなり壁が高く、最初からそういうのを狙ってしまうと続けられなくなります。</p>

<h2>使ったことあるなしは気にしない</h2>

<p>ビルドやテストが通る環境が出来てしまえさえすれば、そのプロジェクトを使ったことあるなしは特に問題ありません。</p>

<p>自分の場合、今直近で出しているpull requestは全て使ったことがないプロジェクトだったりします。
(ぶっちゃけると使ったことがないほうがマージされて壊れちゃっても業務に支障出ないし、気楽だったりします。)</p>

<h1>必要なスキル</h1>

<p>プルリク駆動勉強で必要なスキルは以下です。</p>

<ul>
<li>gitの基礎やfork->commit->pull requestまでが出来る</li>
<li>コードレビューでも折れない心</li>
<li>自分のスキルではまだ出来ないと思わないこと</li>
</ul>


<h2>gitの基礎やfork->commit->pull requestまでが出来る</h2>

<p>pull requestを投げるまでの流れはググればすぐ出てくるので、説明省略。</p>

<p>それ以外でもgit/githubの問題はやっているとちょくちょく出てきますが、都度やりたいことをググれば出てきます。勉強して下さい。どうしてもわからない場合は直接聞いてしまってもいいです。</p>

<p>fork元のブランチとの同期方法が最初の壁だと思います。面倒であれば、forkしたリポジトリを消して再度forkして同期を取るのもありです。
(ただし、マージ前のpull requestがあったりすると面倒なので、注意。)
これも勉強だと思って、わからないのであればググッてみて下さい。「fork 更新 追随」とかで検索すれば出てきます。</p>

<h2>コードレビューでも折れない心</h2>

<p>特に経験の少ない人や潰れていった人に多いのがコードレビューの指摘点がその人に対して言っているのでは？と勘違いしていることです。</p>

<p><strong>コードレビューはコードに対して言っているのであって、そのコードを書いた人に対しては言っていないです。</strong></p>

<p>この考えになってない人は早めに切り替えないと精神的に病みやすいので気をつけて下さい。
辛辣な意見があるかもしれませんが、あなたを否定しているわけではないです。
(逆にコードを書いた人を否定するような意見をするレビュアーがいる場合、さっさとそのプロジェクトから離れるなり、転職するなりしたほうがいいです。そういう人と一緒にコード書いても精神的に疲れるだけです。)</p>

<h2>自分のスキルではまだ出来ないと思わないこと</h2>

<p>プルリク駆動勉強で一番問題なのが、「自分のスキルではまだ出来ない」と思う心の壁です。</p>

<p>どれほどしょぼいコードでもpull requestを投げることで、そのプロジェクトに関わっている人に指摘してもらい、コードをどう書けばいいのかがわかってきます。</p>

<p>自分の場合、一度も書いたことなかった言語を触りたいからということで、コード読んでpull request投げたこともあります。</p>

<p>最終的に良いアウトプットになればいいわけで、最初から完璧を目指す必要がないです。また最初からほぼ完璧なコードが作れるのであれば、プルリク駆動勉強はもう卒業しています。</p>

<p>会社でのプログラミングは社内の特殊なルールがあったりし、社外で通じないことが多々あります。有名どころのプロジェクトではベストプラクティスを求められるため、じっくり設計し、自分が考えたさいきょうのコードを作り上げることが出来ます。どんなことでもコントリビュートしてくれたことに感謝してくれるプロジェクトが多いです。無料で世界レベルのエンジニアに教えてもらい、さらに感謝までしてもらえます。そのコードがマージまでされれば、世界で使われるような有名なプロジェクトが自分のコードで動くことになります！</p>

<h1>個人的な成果</h1>

<p>まだ3ヶ月ほどですが、これをやるようになって、Java8, Groovy/Gradle, Kotlinの勉強が出来ました。Rubyや英語のスキルも上がったことを実感しています。</p>

<p>また、gitの知識もかなり深まりました。他人の途中のpull requestを自分のpull requestとして取り込み、修正し、投げるみたいな貴重な経験も出来ました。小さいアイコンと大きいアイコンが一度に出るような<a href="https://github.com/excilys/androidannotations/pull/1603/commits">コミット</a>見たことありますか？</p>

<h1>気をつけること</h1>

<p>時間をかければかけるだけ勉強は出来ますが、業務に支障が出たり、最悪体を壊してしまいます。</p>

<p>以前はブログを書いたり、本を読んだりと夜遅くまでダラダラをやっていました。でもいまいち成果が出なかったです。今は短い時間で集中して結果を出していくことを心がけています。夜12時には寝ます。お昼休みの食後30分と子供が寝た後の1時間だけやっています。無理は絶対にしません。だって、納期はありませんから。</p>

<p>一日多くの時間がないので、毎日コミットは出来ません。Issueやコードを読むだけで過ぎてしまう日もあります。でも週1くらいのペースでpull requestを投げられています。</p>

<p>スケジューリングに時間を使うのも無駄なので、一個終わったら次のIssueへという流れにしています。</p>

<h1>pull requestが怖い人へ</h1>

<p>そんなこといってもお前スキルあるからやれるんでしょ？みたいな人がいるかと思うので、実際に自分がつい最近送ったくそpull requestを晒しておきます。</p>

<p><a href="https://github.com/excilys/androidannotations/pull/1673">https://github.com/excilys/androidannotations/pull/1673</a></p>

<p>すでに指摘を受けて修正していますが、最初のpull requestを投げたタイミングで、「It&rsquo;s ready for review.」(ﾄﾞﾔｱ)と言っておきながら、
<a href="https://github.com/excilys/androidannotations/pull/1673#discussion_r48849275">AndroidManifest.xmlのActivityタグにViewクラスを指定する</a>という意味不明な行動をしていたり、<a href="https://github.com/excilys/androidannotations/pull/1673#discussion-diff-49131871">newInsanceVarというtypoをかましていたり</a>といろいろひどいです。それでも罵られたりすることはないです。(いい加減罵られたほうがいいんじゃねーか？というレベルなのですが・・・)</p>

<h1>最後に</h1>

<p>この勉強法を使って経験が浅い若手や学生がどんどん世界で腕を磨いてくれたらと思います。特に時間のある人は積極的にコードを公開し、レビューを受けて腕を磨いて下さい。早ければ早いほど学べることが多いと思います。</p>

<p>自分もスキルに自信がついたら・・・とGitHubでpull requestをほとんど送ってこなかったのですが、そんな自信はやらない限り絶対につかないです。どんどん他人のプロジェクトで失敗して、腕を磨いて下さい。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[リファクタリングについて伝えたいこと。]]></title>
    <link href="http://shiraji.github.io/blog/2015/10/17/refactoring/"/>
    <updated>2015-10-17T11:39:09+09:00</updated>
    <id>http://shiraji.github.io/blog/2015/10/17/refactoring</id>
    <content type="html"><![CDATA[<p>この文章は以下のURLのコピーです。</p>

<p><a href="http://shiraji.hatenablog.com/entry/2015/09/06/225204">http://shiraji.hatenablog.com/entry/2015/09/06/225204</a></p>

<hr />

<p>この文章は以下に該当する方へ、なぜエンジニアにリファクタリング(リファクタ)させるべきなのかを記載しています。</p>

<ul>
<li>リファクタリングする＝サービスの開発が停止すると考えている方</li>
<li>リファクタリングに関して価値を見出せない方</li>
<li>エンジニアにリファクタリングさせて欲しいと言われる方</li>
</ul>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<!-- 728x90 -->


<p><ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3940616565912592"
     data-ad-slot="7693358062"></ins></p>

<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h1>最初に</h1>

<p>リファクタリングの話をする前に、一般的な職場に関する質問があります。</p>

<ul>
<li>あなたの職場は綺麗ですか？</li>
<li>あなたが思い浮かべる「できる同僚・上司」の机は整理整頓されていますか？</li>
</ul>


<p>全ての人に当てはまるわけではないと思います。しかし大抵の方は両方回答がYesになると思います。</p>

<p>職場を綺麗にするのはそこで働く人の健康維持やモチベーション向上に役立ちます。職場を綺麗にしてくれる専門のスタッフがいる企業もあるのではないでしょうか？また整理整頓された机で仕事することにより、ムダを省略することが出来ます。仕事をするスペースが増えることにより効率もあがります。大抵の出来る人は机を整理整頓している傾向があるそうです。著名な会社の研修でも同じようなことを説いていました。</p>

<p>汚い環境で働くということは、モチベーションを下げ、ムダな作業を発生させ、効率を下げるということです。汚い環境で働くのは非常に辛く、可能であれば、人はその環境から離れていきます。</p>

<h1>リファクタリングとは何か？</h1>

<p>さて、本題のリファクタリングについてです。wikipediaでは以下のように説明されています。</p>

<blockquote><p>リファクタリング (refactoring) とはコンピュータプログラミングにおいて、プログラムの外部から見た動作を変えずにソースコードの内部構造を整理すること。((&ldquo;リファクタリング (プログラミング)&rdquo;. wikipedia. <a href="https://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0_">https://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0_</a>(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0))</p></blockquote>

<p>もう少しサービス開発に絡めて切り込んだ説明にすると、</p>

<p>「リファクタリングするということは、サービスの機能の追加や削除は一切行わず、コストをかけて、今まで動いていたコードに対して修正を加える作業です。」</p>

<p>リファクタリングをすることにより、バグを埋め込んでサービスを止めてしまう可能性も含まれることになります。もちろんそれを避ける術はいくつかあるのですが、手段はエンジニアが考えればいいのでここでは省略させていただきます。</p>

<h1>リファクタリングをなぜやるのか？</h1>

<p>なぜこんなムダな作業を行うのでしょうか？エンジニアはアホなんでしょうか？</p>

<h3>エンジニアはコード上で仕事をしている</h3>

<p>（実際、アホなことやる人は多いですが・・・）事自分たちが行っているサービス開発に関して言えば、プライドを持って行っているはずです。サービスに携わっている以上、そのサービスがより良くなることを望んで開発しています。そのエンジニアがコストがかかることを承知で、リファクタリングさせて欲しいという理由があります。それはエンジニアは<b>コード上で仕事をしている</b>ということです。</p>

<h3>デスクの綺麗さとコードの綺麗さ</h3>

<p>私が非エンジニアにリファクタリングの重要性を説明する時は以下のように説明します。</p>

<ul>
<li>デスクに毎日のようにいろんな人が資料を置いていくとします。</li>
<li>資料を置くことを目的にする社員もいるので、資料はあなたが意図した場所には置かれません。</li>
<li>デスクがどんどん汚くなっていき、必要な資料を探すのに苦労します。</li>
<li>間違った資料を使って仕事をする可能性も出てきます。</li>
<li>このような状況になった場合、あなたがまず最初に行うのが、整理整頓だと思います。</li>
</ul>


<p>ではエンジニアはコード上で仕事をしているということなので、デスクを「コード」、置かれていく資料を「追加機能」と読み替えてみます。</p>

<ul>
<li>コードに毎日のようにいろんな人が機能を追加していきます。</li>
<li>機能追加を目的にする社員もいるので、エンジニアが意図した場所に機能が追加されません。</li>
<li>コードがどんどん汚くなっていき、必要な機能を調査するのに苦労します。</li>
<li>間違った機能を使って仕事をする可能性も出てきます。(=バグを作り出す)</li>
<li>このような状況になった場合、エンジニアがまず最初に行うのが、整理整頓(=リファクタリング)だと思います。</li>
</ul>


<p>エンジニアが作業しているコードを綺麗にすることにより、将来的にバグを作り出さなかったり、効率良く作業が出来る環境を作ることが出来ます。</p>

<h3>エンジニアを惹きつける、引き止めるためのリファクタリング</h3>

<p>汚い環境で働くということは、モチベーションを下げ、ムダな作業を発生させ、効率を下げるということです。汚い環境で働くのは非常に辛く、可能であれば、人はその環境から離れていきます。</p>

<p>この文章も同じように読み替えることが出来ます。</p>

<p>汚いコード上で働くということは、モチベーションを下げ、ムダな作業を発生させ、効率を下げるということです。汚いコード上で働くのは非常に辛く、可能であれば、エンジニアはそのコード（会社）から離れていきます。</p>

<p>エンジニアが働く場所の環境を良くすることとそのエンジニアを魅了するためにリファクタリングをさせる猶予を与えてあげてください。この魅力的な余裕があることでエンジニアとしてやる気が向上し、整理されたコードで仕事が出来るためパフォーマンスが上がります。働きやすい職場(コード)で最高のパフォーマンスを出すことが出来るのであれば、エンジニアが離職するのを引き止めるのに役立つはずです。</p>

<h1>まとめ</h1>

<p>汚い場所で人を働かせることが辛いということがわかるのであるなら、ぜひ汚い環境で働かされているエンジニアに掃除をする猶予を与えてあげてください。それが長期的に見るとサービスを改善を早くし、技術力のあるエンジニアを定着させ、変化に柔軟なサービスを提供させることが出来るようになるからです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自己紹介]]></title>
    <link href="http://shiraji.github.io/blog/2015/10/17/intro/"/>
    <updated>2015-10-17T07:31:51+09:00</updated>
    <id>http://shiraji.github.io/blog/2015/10/17/intro</id>
    <content type="html"><![CDATA[<p>shirajiと申します。GitHub活動は英語で行っていますが、このブログは日本語で記載していきたいと思います。</p>

<ul>
<li>Twitter: <a href="https://twitter.com/shiraj_i">@shiraj_i</a></li>
<li>Qiita: <a href="http://qiita.com/shiraji">shiraji</a></li>
</ul>


<p>よろしくお願いいたします。</p>
]]></content>
  </entry>
  
</feed>
